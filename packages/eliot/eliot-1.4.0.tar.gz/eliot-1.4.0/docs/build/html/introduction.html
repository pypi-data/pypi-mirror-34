

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Why Eliot? &mdash; Eliot 1.3.0+31.g662262a documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="What’s New" href="news.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Eliot
          

          
          </a>

          
            
            
              <div class="version">
                1.3.0+31.g662262a
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Why Eliot?</a></li>
<li class="toctree-l1"><a class="reference internal" href="news.html">What’s New</a></li>
<li class="toctree-l1"><a class="reference internal" href="generating/index.html">Generating Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="outputting/index.html">Outputting Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="reading/index.html">Reading Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Contributing to Eliot</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Eliot</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Why Eliot?</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/introduction.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="why-eliot">
<h1>Why Eliot?<a class="headerlink" href="#why-eliot" title="Permalink to this headline">¶</a></h1>
<blockquote class="epigraph">
<div><p>Suppose we turn from outside estimates of a man, to wonder, with keener
interest, what is the report of his own consciousness about his doings or
capacity: with what hindrances he is carrying on his daily labors; what
fading of hopes, or what deeper fixity of self-delusion the years are
marking off within him; and with what spirit he wrestles against universal
pressure, which will one day be too heavy for him, and bring his heart to
its final pause.</p>
<blockquote>
<div>— George Eliot, <em>Middlemarch</em></div></blockquote>
</div></blockquote>
<p>The log messages generated by a piece of software tell a story: what, where, when, even why and how if you’re lucky. The readers of this story are more often than not other programs: monitoring systems, performance tools, or just filtering the messages down to something a human can actually comprehend. Unfortunately the output of most logging systems is ill-suited to being read by programs. Even worse, most logging systems omit critical information that both humans and their programs need.</p>
<div class="section" id="problem-1-text-is-hard-to-search">
<h2>Problem #1: Text is hard to search<a class="headerlink" href="#problem-1-text-is-hard-to-search" title="Permalink to this headline">¶</a></h2>
<p>Let’s say you want to find all the log messages about a specific person. A first pass of log messages might look like this:</p>
<blockquote>
<div>Sir James Chettam was going to dine at the Grange to-day with another gentleman whom the girls had never seen, and about whom Dorothea felt some venerating expectation.
…
If Miss Brooke ever attained perfect meekness, it would not be for lack of inward fire.</div></blockquote>
<p>You could do a text search for log messages containing the text “Dorothea”, but this is likely to fail for some types of searches. You might want to searching for actions involving dinner, but then you would need to search for “dine” and “dinner” and perhaps other words well. A library like <a class="reference external" href="https://structlog.readthedocs.org/">structlog</a> that can generate structured log messages will solve this first problem. You could define a “person” field in your messages and then you can search for all messages where <code class="docutils literal notranslate"><span class="pre">person</span> <span class="pre">==</span> <span class="pre">&quot;Dorothea&quot;</span></code> as well as other structured queries.</p>
</div>
<div class="section" id="problem-2-referring-to-entities">
<h2>Problem #2: Referring to Entities<a class="headerlink" href="#problem-2-referring-to-entities" title="Permalink to this headline">¶</a></h2>
<p>Every time a log message is written out you need to decide how to refer to the objects being logged. In the messages we saw above “Dorothea” and “Miss Brooke” are in fact different identifiers for the same person. Having structured messages doesn’t help us find all messages about a specific entity if the object is referred to inconsistently. What you need is infrastructure for converting specific kinds of objects in your code to fields in your structured log messages. Then you can just say “log a message that refers to this Person” and that reusable code will make sure the correct identifier is generated.</p>
</div>
<div class="section" id="problem-3-actions">
<h2>Problem #3: Actions<a class="headerlink" href="#problem-3-actions" title="Permalink to this headline">¶</a></h2>
<p>Most log messages in your program are going to involve actions:</p>
<blockquote>
<div>Not long after that dinner-party she had become Mrs. Casaubon, and was on her way to Rome.</div></blockquote>
<p>A marriage has a beginning and eventually an end. The end may be successful, presuming “until death do us part” is a form of success, or a failure. The same is true of all actions, much like function calls in Python are started and eventually return a result or throw an exception. Actions may of course span multiple function calls or extended periods of time.</p>
<p>Actions also generate other actions: a marriage leads to a trip to Rome, the trip to Rome might lead to a visit to the Vatican Museum, and so on. Other unrelated actions are occurring at the same time, resulting in a forest of actions, with root actions that grow a tree of child actions.</p>
<p>You might want to trace an action from beginning to end, e.g. to measure how long it took to run. You might want to know what high-level action caused a particular unexpected low-level action. You might want to know what actions a specific entity was involved with. None of these are possible in most logging systems since they have no concept of actions to begin with.</p>
</div>
<div class="section" id="problem-4-cross-process-actions">
<h2>Problem #4: Cross-Process Actions<a class="headerlink" href="#problem-4-cross-process-actions" title="Permalink to this headline">¶</a></h2>
<p>A story may involve many characters in many places at many times.
The novelist has the power to present the internal consciousness of not just one character but many: their ways of thinking, their different perceptions of reality.</p>
<p>Similarly, actions in a distributed system may span multiple processes.
An incoming request to one server may cause a ripple of effects reaching many other processes; the logs from a single process in isolation are insufficient to understand what happened and why.</p>
</div>
<div class="section" id="the-solution-eliot">
<h2>The Solution: Eliot<a class="headerlink" href="#the-solution-eliot" title="Permalink to this headline">¶</a></h2>
<p>Eliot is designed to solve all of these problems.
For simplicity’s sake this example focuses on problems 1 and 3; problem 2 is covered by the <a class="reference internal" href="generating/types.html#type-system"><span class="std std-ref">type system</span></a> and problem 4 by <a class="reference internal" href="generating/threads.html#cross-process-tasks"><span class="std std-ref">cross-process actions</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sys</span> <span class="k">import</span> <span class="n">stdout</span>
<span class="kn">from</span> <span class="nn">eliot</span> <span class="k">import</span> <span class="n">Message</span><span class="p">,</span> <span class="n">to_file</span>
<span class="n">to_file</span><span class="p">(</span><span class="n">stdout</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Place</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">contained</span><span class="o">=</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contained</span> <span class="o">=</span> <span class="n">contained</span>

    <span class="k">def</span> <span class="nf">visited</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">people</span><span class="p">):</span>
        <span class="n">Message</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">message_type</span><span class="o">=</span><span class="s2">&quot;visited&quot;</span><span class="p">,</span>
                    <span class="n">people</span><span class="o">=</span><span class="n">people</span><span class="p">,</span> <span class="n">place</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contained</span><span class="p">:</span>
            <span class="n">thing</span><span class="o">.</span><span class="n">visited</span><span class="p">(</span><span class="n">people</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">honeymoon</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>
    <span class="n">Message</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">message_type</span><span class="o">=</span><span class="s2">&quot;honeymoon&quot;</span><span class="p">,</span> <span class="n">people</span><span class="o">=</span><span class="n">family</span><span class="p">)</span>
    <span class="n">destination</span><span class="o">.</span><span class="n">visited</span><span class="p">(</span><span class="n">family</span><span class="p">)</span>


<span class="n">honeymoon</span><span class="p">([</span><span class="s2">&quot;Mrs. Casaubon&quot;</span><span class="p">,</span> <span class="s2">&quot;Mr. Casaubon&quot;</span><span class="p">],</span>
          <span class="n">Place</span><span class="p">(</span><span class="s2">&quot;Rome, Italy&quot;</span><span class="p">,</span>
                <span class="p">[</span><span class="n">Place</span><span class="p">(</span><span class="s2">&quot;Vatican Museum&quot;</span><span class="p">,</span>
                       <span class="p">[</span><span class="n">Place</span><span class="p">(</span><span class="s2">&quot;Statue #1&quot;</span><span class="p">),</span> <span class="n">Place</span><span class="p">(</span><span class="s2">&quot;Statue #2&quot;</span><span class="p">)])]))</span>
</pre></div>
</div>
<p>Here’s how the log messages generated by the code look, as summarized by the <a class="reference external" href="https://warehouse.python.org/project/eliot-tree/">eliot-tree</a> tool:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">68</span><span class="n">c12428</span><span class="o">-</span><span class="mi">5</span><span class="n">d60</span><span class="o">-</span><span class="mi">49</span><span class="n">f5</span><span class="o">-</span><span class="n">a269</span><span class="o">-</span><span class="mi">3</span><span class="n">fb681938f98</span>
<span class="o">+--</span> <span class="n">honeymoon</span><span class="nd">@1</span>
    <span class="o">|--</span> <span class="n">people</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Mrs. Casaubon&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;Mr. Casaubon&#39;</span><span class="p">]</span>

<span class="mi">361298</span><span class="n">ae</span><span class="o">-</span><span class="n">b6b7</span><span class="o">-</span><span class="mi">439</span><span class="n">a</span><span class="o">-</span><span class="n">bc9b</span><span class="o">-</span><span class="n">ffde68b7860d</span>
<span class="o">+--</span> <span class="n">visited</span><span class="nd">@1</span>
    <span class="o">|--</span> <span class="n">people</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Mrs. Casaubon&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;Mr. Casaubon&#39;</span><span class="p">]</span>
    <span class="o">|--</span> <span class="n">place</span><span class="p">:</span> <span class="n">Rome</span><span class="p">,</span> <span class="n">Italy</span>

<span class="mi">7</span><span class="n">fe1615c</span><span class="o">-</span><span class="n">e442</span><span class="o">-</span><span class="mi">4</span><span class="n">bca</span><span class="o">-</span><span class="n">b667</span><span class="o">-</span><span class="mi">7</span><span class="n">bb435ac6cb8</span>
<span class="o">+--</span> <span class="n">visited</span><span class="nd">@1</span>
    <span class="o">|--</span> <span class="n">people</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Mrs. Casaubon&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;Mr. Casaubon&#39;</span><span class="p">]</span>
    <span class="o">|--</span> <span class="n">place</span><span class="p">:</span> <span class="n">Vatican</span> <span class="n">Museum</span>

<span class="n">c746230c</span><span class="o">-</span><span class="mf">627e-4</span><span class="n">ff9</span><span class="o">-</span><span class="mi">9173</span><span class="o">-</span><span class="mi">135568</span><span class="n">df976c</span>
<span class="o">+--</span> <span class="n">visited</span><span class="nd">@1</span>
    <span class="o">|--</span> <span class="n">people</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Mrs. Casaubon&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;Mr. Casaubon&#39;</span><span class="p">]</span>
    <span class="o">|--</span> <span class="n">place</span><span class="p">:</span> <span class="n">Statue</span> <span class="c1">#1</span>

<span class="mi">5482</span><span class="n">ec10</span><span class="o">-</span><span class="mi">36</span><span class="n">c6</span><span class="o">-</span><span class="mi">4194</span><span class="o">-</span><span class="mi">964</span><span class="n">f</span><span class="o">-</span><span class="mf">074e325</span><span class="n">b9329</span>
<span class="o">+--</span> <span class="n">visited</span><span class="nd">@1</span>
    <span class="o">|--</span> <span class="n">people</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Mrs. Casaubon&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;Mr. Casaubon&#39;</span><span class="p">]</span>
    <span class="o">|--</span> <span class="n">place</span><span class="p">:</span> <span class="n">Statue</span> <span class="c1">#2</span>
</pre></div>
</div>
<p>We can see different messages are related insofar as they refer to the same person, or the same thing… but we can’t trace the relationship in terms of actions. Was looking at a statue the result of visiting Rome? There’s no way we can tell from the log messages. We could manually log start and finish messages but that won’t suffice when we have many interleaved actions involving the same objects. Which of twenty parallel HTTP request tried to insert a row into the database? Chronological messages simply cannot tell us that.</p>
<p>The solution is to introduce two new concepts: actions and tasks. An “action” is something with a start and an end; the end can be successful or it can fail due to an exception. Log messages, as well as log actions, know the log action whose context they are running in. The result is a tree of actions. A “task” is a top-level action, a basic entry point into the program which drives other actions. The task is therefore the root of the tree of actions. For example, an HTTP request received by a web server might be a task.</p>
<p>In our example we have one task (the honeymoon), an action (travel). We will leave looking as a normal log message because it always succeeds, and no other log message will ever need to run its context. Here’s how our code looks now:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sys</span> <span class="k">import</span> <span class="n">stdout</span>
<span class="kn">from</span> <span class="nn">eliot</span> <span class="k">import</span> <span class="n">start_action</span><span class="p">,</span> <span class="n">start_task</span><span class="p">,</span> <span class="n">to_file</span>
<span class="n">to_file</span><span class="p">(</span><span class="n">stdout</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Place</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">contained</span><span class="o">=</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contained</span> <span class="o">=</span> <span class="n">contained</span>

    <span class="k">def</span> <span class="nf">visited</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">people</span><span class="p">):</span>
        <span class="c1"># No need to repetitively log people, since caller will:</span>
        <span class="k">with</span> <span class="n">start_action</span><span class="p">(</span><span class="n">action_type</span><span class="o">=</span><span class="s2">&quot;visited&quot;</span><span class="p">,</span> <span class="n">place</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contained</span><span class="p">:</span>
                <span class="n">thing</span><span class="o">.</span><span class="n">visited</span><span class="p">(</span><span class="n">people</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">honeymoon</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">start_task</span><span class="p">(</span><span class="n">action_type</span><span class="o">=</span><span class="s2">&quot;honeymoon&quot;</span><span class="p">,</span> <span class="n">people</span><span class="o">=</span><span class="n">family</span><span class="p">):</span>
        <span class="n">destination</span><span class="o">.</span><span class="n">visited</span><span class="p">(</span><span class="n">family</span><span class="p">)</span>


<span class="n">honeymoon</span><span class="p">([</span><span class="s2">&quot;Mrs. Casaubon&quot;</span><span class="p">,</span> <span class="s2">&quot;Mr. Casaubon&quot;</span><span class="p">],</span>
          <span class="n">Place</span><span class="p">(</span><span class="s2">&quot;Rome, Italy&quot;</span><span class="p">,</span>
                <span class="p">[</span><span class="n">Place</span><span class="p">(</span><span class="s2">&quot;Vatican Museum&quot;</span><span class="p">,</span>
                       <span class="p">[</span><span class="n">Place</span><span class="p">(</span><span class="s2">&quot;Statue #1&quot;</span><span class="p">),</span> <span class="n">Place</span><span class="p">(</span><span class="s2">&quot;Statue #2&quot;</span><span class="p">)])]))</span>
</pre></div>
</div>
<p>Actions provide a Python context manager. When the action or task starts a start message is logged.
If the block finishes successfully a success message is logged for the action; if an exception is thrown a failure message is logged for the action with the exception type and contents.
Not shown here but supported by the API is the ability to add fields to the success messages for an action. A similar API supports Twisted’s Deferreds.</p>
<p>Here’s how the log messages generated by the new code look, as summarized by the <a class="reference external" href="https://warehouse.python.org/project/eliot-tree/">eliot-tree</a> tool:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">f9dcc74f-ecda-4543-9e9a-1bb062d199f0</span>
<span class="go">+-- honeymoon@1/started</span>
<span class="go">    |-- people: [u&#39;Mrs. Casaubon&#39;, u&#39;Mr. Casaubon&#39;]</span>
<span class="go">    +-- visited@2,1/started</span>
<span class="go">        |-- place: Rome, Italy</span>
<span class="go">        +-- visited@2,2,1/started</span>
<span class="go">            |-- place: Vatican Museum</span>
<span class="go">            +-- visited@2,2,2,1/started</span>
<span class="go">                |-- place: Statue #1</span>
<span class="go">                +-- visited@2,2,2,2/succeeded</span>
<span class="go">            +-- visited@2,2,3,1/started</span>
<span class="go">                |-- place: Statue #2</span>
<span class="go">                +-- visited@2,2,3,2/succeeded</span>
<span class="go">            +-- visited@2,2,4/succeeded</span>
<span class="go">        +-- visited@2,3/succeeded</span>
<span class="go">    +-- honeymoon@3/succeeded</span>
</pre></div>
</div>
<p>No longer isolated fragments of meaning, our log messages are now a story. Log events have context, you can tell where they came from and what they led to without guesswork. Was looking at a statue the result of the honeymoon? It most definitely was.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="news.html" class="btn btn-neutral float-right" title="What’s New" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quickstart.html" class="btn btn-neutral" title="Quickstart" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2018, ClusterHQ and Itamar Turner-Trauring.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.3.0+31.g662262a',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>