dist: trusty
sudo: false
language: python

python:
- nightly
- &latest_py3 3.6

jobs:
  fast_finish: true
  include:
  - stage: deploy
    if: tag IS present
    python: *latest_py3
    install: skip
    script: skip
    deploy:
      provider: pypi
      on:
        tags: true
        all_branches: true
      user: jaraco
      password:
        secure: J+PGeGI/u2D/9Iq21SFh/PA+jQHUmBUP8jaczdM/qWFznGPkB03ciFbSyRNfJzK6fBboHnV6m55MLrzhgZpC0LzGMIFJindtNkgfxegqzoaDWSFkVcjV5NAdd6g/07+PRNPJl/k6NIEPUw6CgfDoKLHPpvke8bzkR5HNVczj2wZgu5svBrDFG999aQ/Uw5MPqB2ZTF0RlK2FAz+30UkWYBO1DkRIkpBDHDxlx8xv46pcFw+P/m8q4CQhWpTkyCjM0rX99mBmCa7zD06F25wZ6xZVwI2hbpwYxNdpYl7k4KcvOztZopJuZUojk9zTx+MdaJKNoYalC0l4gAS47ES2wAysGSoIFIIuQUkiW2ovSLgPWDDBce0fX4EqMJuJZMNZvhuKHZDm+cgxvWcKoomCm1ZEZlVcThYgpPXs3IiBdVfG9jnafNAZ5WCBBkk0u8y3CaGGkhc6S35aW/B85hglsKWjg5XVIncerUTAXwz1Ly192CEcWhyDSLNTfOcTGI54QTCfVVESeuovhoDgUQDDQOGvlN1kOFbd9d1RJXYdiEbCPlmRmNPuXx6HfbWfw1WkNT55XLLiXDaWAo9CVrbWMF6IIRATKQQGlWCS1qtRs/9iDCEZPouLZiyCjg9FzoQjRwPU5usqaxSPANVJvLWCe/bjGxpRLYJ4EGgHBMOVlZs=
      distributions: dists
      skip_cleanup: true

matrix:
  allow_failures:
  - python: nightly

cache: pip

install:
- pip install tox tox-venv

before_script:
  # Disable IPv6. Ref travis-ci/travis-ci#8361
  - if [ "${TRAVIS_OS_NAME}" == "linux" ]; then
      sudo sh -c 'echo 0 > /proc/sys/net/ipv6/conf/all/disable_ipv6';
    fi
script: tox
