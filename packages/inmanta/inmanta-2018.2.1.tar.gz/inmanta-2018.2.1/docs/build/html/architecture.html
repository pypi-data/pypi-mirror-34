

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Architecture &mdash; Inmanta 2017.4dev documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Inmanta 2017.4dev documentation" href="index.html"/>
        <link rel="next" title="Language Reference" href="language.html"/>
        <link rel="prev" title="Install Inmanta" href="install.html"/>
<style>
.version a:visited {
  color: rgba(255,255,255,0.3);
}
</style>


  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          


    <a href="index.html">



  
    <img src="_static/inmanta-logo.png" class="logo" />

    </a>
    <div class="version">
      <a href="/" class="icon icon-home"> Documentation home</a>
    </div>
    <div class="version">
      2017.4dev
    </div>

    
  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install Inmanta</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#embedded">Embedded</a></li>
<li class="toctree-l2"><a class="reference internal" href="#push-to-server">Push to server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#autonomous-server">Autonomous server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#agent-deployment">Agent deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#server-side-agents">Server side agents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#local-agents">Local Agents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="language.html">Language Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="guides.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="moduleguides.html">Module guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/index.html">Inmanta Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Inmanta</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Architecture</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="architecture">
<h1>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h1>
<p>The Inmanta orchestrator consists of several components:</p>
<a class="reference internal image-reference" href="_images/component.svg"><img alt="Overview of the Inmanta platform" src="_images/component.svg" width="90%" /></a>
<ul class="simple">
<li>The Inmanta <strong>server</strong>: This server manages the deployment process, it keeps track of all agents and the current state of all
projects. The server stores it state in mongodb. All other state can be recovered after a server restart or failover. All
other components use the REST API for bidirectional communication with the server. The complete server is asynchronous to
ensure scalability.</li>
<li>A mongodb database: The Inmanta server stores it state in a mongo database.</li>
<li>The git server: The source code of the configuration models is stored in (one or more) git repositories.</li>
<li>The <strong>compiler</strong>: The compiler converts the source code into deployable artifacts and exports it to the server.</li>
<li>CLI and Dashboard: To control the server, you can use either the web dashboard or the command line tools. Both communicate
through the server rest API. The dashboard is an AngularJS webapplication that fully depends on the REST API.</li>
<li>The Inmanta <strong>agents</strong>: Agents execute configuration changes on targets. A target can be a server, a network switch or an API
of  cloud service. An agent can manage local and remote resources. This provides the flexibility to work in an agent based or
agent-less architecture, depening on the requirements. Agent communicate with the server over an bidirectional REST API.</li>
</ul>
<p>Inmanta can be deployed/used in three variants:</p>
<ul class="simple">
<li><strong>embedded</strong>: all components are started with the deploy command, the server is terminated after the deploy is finished. Suitable only for development.</li>
<li><strong>push to server</strong>: the server runs on a external machine. Models are compiled on the developer machine and pushed to the server directly. Suitable only for small setups or for developement/debug purposes.</li>
<li><strong>autonomous server</strong>: the server runs on a external machine. Models are stored in git repos and compiled by the server.</li>
</ul>
<p>The last two variants support agents on the same machine as the server or deployed on the management targets.</p>
<div class="section" id="embedded">
<h2>Embedded<a class="headerlink" href="#embedded" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/embedded.svg"><img alt="Embedded deployment" src="_images/embedded.svg" width="90%" /></a>
<p>In a embedded deployment, all components (server, agent and mongo) are started embedded in the compiler and terminated after
the deploy is complete. No specific setup is required. To deploy the current model, use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">inmanta</span> <span class="n">deploy</span>
</pre></div>
</div>
<p>State related to orchestration is stored locally in data/deploy. This model is ideal of testing, development and one-off
deployments.</p>
</div>
<div class="section" id="push-to-server">
<h2>Push to server<a class="headerlink" href="#push-to-server" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/pushtoserver.svg"><img alt="Embedded deployment" src="_images/pushtoserver.svg" width="90%" /></a>
<p>In a push to server model, the server is deployed on an external machine, but models are still compiled on the developer
machine. This gives faster feedback to developers, but makes the compilation less reproducible. It also complicates
collaboration.</p>
</div>
<div class="section" id="autonomous-server">
<h2>Autonomous server<a class="headerlink" href="#autonomous-server" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/overview.svg"><img alt="Embedded deployment" src="_images/overview.svg" width="90%" /></a>
<p>With an autonomous server, developers can no longer push models into production directly. Only the server itself compiles the
models. This ensures that every compile is repeatable and allows collaboration because all changes <em>have</em> to be committed.</p>
</div>
<div class="section" id="agent-deployment">
<h2>Agent deployment<a class="headerlink" href="#agent-deployment" title="Permalink to this headline">¶</a></h2>
<p>In the embedded model the agent is always executed by the compiler process. The two other modes provide the flexibility to
deploy agents independant of the server or let the server manage the agents. Agents are the processes that make configuration
changes to resources. Each resource is managed by an agent. The mapping of resources to agents is defined by the resource
designer, however as a rule of thumb: each device (server, vm, switch, …) is an agent, each API endpoint (OpenStack or AWS
region, …) is also an agent.</p>
<p>Each agent is hosted by one or more processes that can be started by the server (on the same machine) or manually on multiple
machines. When more than one agent hosts an agent, the server will elect a primary and pauses the other agents. A single agent
process (python process) can host multiple agents. Server side agents are always mapped to a single process per environment.
The number of process influences the deployment speed in large environments.</p>
<div class="section" id="server-side-agents">
<h3>Server side agents<a class="headerlink" href="#server-side-agents" title="Permalink to this headline">¶</a></h3>
<p>The server is capable of running one or more agents. Server side agents are used for</p>
<ol class="arabic simple">
<li>agent that talk to API’s.  When the agent is not tied to any specific machine, it can be run on the server itself.</li>
<li>agentless operation. Agents can remotely manage their target machine through SSH.</li>
</ol>
</div>
<div class="section" id="local-agents">
<h3>Local Agents<a class="headerlink" href="#local-agents" title="Permalink to this headline">¶</a></h3>
<p>A local agent is most often used to manage the machine in which it is deployed. The agent will then connect to the to
management server and manages the resources on the machine it is deployed.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="language.html" class="btn btn-neutral float-right" title="Language Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="install.html" class="btn btn-neutral" title="Install Inmanta" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017 Inmanta NV.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2017.4dev',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>