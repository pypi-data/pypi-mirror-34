from concurrent.futures import ThreadPoolExecutor
from bs4 import BeautifulSoup as BS
import requests
from termcolor import colored
exe = ThreadPoolExecutor(max_workers=10)

def l(*args):
    print(colored("[+]",'green'), *args)


def usage():
    l("get http banner's title")

def test_single(url, ssl=False):
    if ssl:
        u = 'https://' + url
    else:
        u = 'http://' + url
    try:
        res = requests.get(u)
        if res.status_code == 200:
            t = BS(res.text, 'html.parser')("title")[0].text
            if isinstance(t, bytes):
                t = t.decode(res.encoding, 'ignore')
            l(url, t)
    except Exception as e:
        print(colored("[%s] "%url, "green"), colored(e, 'red'))

def test(targets):
    hosts = []
    for i in targets:
        for ii in i.ports.split("/"):
            hosts.append(i.ip + ":" + ii)

    for host in hosts:
        exe.submit(test_single, host)