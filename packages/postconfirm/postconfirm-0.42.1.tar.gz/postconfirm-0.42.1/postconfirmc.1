." Text automatically generated by txt2man-1.4.7
.TH untitled  "July 10, 2017" "" ""
.SH NAME
\fBpostconfirm \fP- Mail confirmation system
\fB
.SH SYNOPSIS
.nf
.fam C
\fBpostconfirmc\fP [\fB-h\fP] [\fB--stop\fP] [\fB--socket\fP \fISOCKET\fP]
[{ \fIconfirm\fP | \fIdmarc-rewrite\fP | \fIdmarc-reverse\fP }]
.PP
\fBpostconfirmd\fP [\fIoptions\fP]
.fam T
.fi
.SH DESCRIPTION

postconfirm consists of \fBpostconfirmd\fP, which is the long-running
(daemon) part, and \fBpostconfirmc\fP, which is the client part of a
client-server program which handles email confirmations. It is
intended as a front-end to mailing lists. It provides
funcitonality which is a subset of TMDA, but is adapted to
high-volume usage and does not have anywhere near all the bells
and whistles which TMDA has. On the other hand, since the
whitelist lookup is done by the long-running server part, the
overhead of doing a verification that a poster has a confirmed
address is much smaller than for TMDA.
.PP
Early tests indicate that with a whitelist of 16000 entries a lookup
costs about 0.01 seconds and about ~5 Mbytes for the server daemon, in
contrast whith TMDA which cost between ~10s and ~600s and ~98 Mb *per
lookup* as it was set up in front of the IETF lists.
.SH ACTIONS
\fIconfirm\fP (the default action):
.PP
Somewhat simplified, the flow for regular mail is as follows:
.PP
.nf
.fam C
     mail agent
         |
         v
     postconfirm/mailman wrapper [copy] -> cached in cache dir
         |
         v
     postconfirmc <==> postconfirmd
         |
         v
     postconfirm/mailman wrapper [white] -> Mailman
       [grey]
         |
         v
     (waiting for confirmation)

.fam T
.fi
In the start of the flow above, a message comes in. If the envelope
From is in the lists known by \fBpostconfirmd\fP, it is passed through the
mailman/ postconfirm wrapper, where \fBpostconfirmc\fP is called to talk
with \fBpostconfirmd\fP and get either an OK to pass the message to Mailman,
or cache it.
.PP
In more detail, this is the sequence of actions that postconfirm goes
through when processing an incoming email message:
.IP 1. 4
The mail is put in the cache directory.
.IP 2. 4
If the message is a delivery-status report (content-type
multipart/report, report-type delivery-status) then this is logged,
and no further action is taken.
.IP 3. 4
If the precedence matches the bulk_regex setting in the
configuration file, then:
.RS
.PP
a. if the envelope sender is in the whitelist or the white_regex
list, then the message is forwarded directly.
.PP
b. if not, the receipt of a bulk message is logged, and no further
action is taken.
.RE
.IP 4. 4
If the message has an auto-submitted header, and the value matches
the auto_submitted_regex in the configuration file, then:
.RS
.PP
a. if the envelope sender is in the whitelist or the white_regex
list, then the message is forwarded directly.
.PP
b. if not, the receipt of a bulk message is logged, and no further
action is taken.
.RE
.IP 5. 4
If the subject matches the regex for postconfirm's confirmation
email subject, the confirmation is processed, and then:
.RS
.PP
a. if the confirmation is valid, the held message is forwarded,
and the confirmed address is added to the whitelist.
.PP
b. if not, the failed confirmation is logged, and the message
is saved.
.RE
.IP 6. 4
If the envelope sender is in the whitelist or the white_regex list,
the message is forwarded.
.IP 7. 4
If there was no match earlier, a confirmation request is sent out
for the message.
.PP
\fIdmarc-rewrite\fP:
.PP
For use with mailing lists, aliases, etc., where the presence of
strict dmarc rules will prevent acceptance of the list messages
unless rewriting is done.
.PP
\fIdmarc-reverse\fP:
.PP
The inverse operation of \fIdmarc-rewrite\fP. Undoes the rewrite, 
and replaces the rewritten address with the original address.
.SH OPTIONS

{ \fIconfirm\fP | \fIdmarc-rewrite\fP | \fIdmarc-reverse\fP }
the action to take
.TP
.B
\fB-h\fP, \fB--help\fP
show this help message and exit
.TP
.B
\fB--stop\fP
stop the \fBpostconfirmd\fP daemon
.TP
.B
\fB--socket\fP \fISOCKET\fP
use the given \fISOCKET\fP for client-daemon communication
.SH FILES
\fBpostconfirmd\fP reads its configuration from the following files (if
found), in the given order:
.PP
.nf
.fam C
      <bin-dir>/postconfirm.conf
      /etc/postconfirm.conf
      /etc/postconfirm/postconfirm.conf
      ~/.postconfirmrc

.fam T
.fi
where <bin-dir> is the directory where \fBpostconfirmd\fP is installed.
.SH AUTHOR
Written by Henrik Levkowetz, <henrik@merlot.tools.ietf.org>. Uses the
daemonize module from Chad J. Schroeder, from the Python Cookbook at
http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/278731, and
the readyexec module from Frank J. Tobin, available at
http://readyexec.sourceforge.net/.
.SH COPYRIGHT
Copyright 2008-2017 Henrik Levkowetz
.PP
This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or (at
your option) any later version. There is NO WARRANTY; not even the
implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
PURPOSE. See the GNU General Public License for more details.
