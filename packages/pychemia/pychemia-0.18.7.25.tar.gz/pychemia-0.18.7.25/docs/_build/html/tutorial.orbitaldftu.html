

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Global optimization of correlation matrices for DFT+U (Abinit) &mdash; pychemia 0.1.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="pychemia 0.1.2 documentation" href="index.html"/>
        <link rel="up" title="Global Minimization with Metaheuristics" href="4.GlobalMinimization.html"/>
        <link rel="prev" title="Optimization of Magnetic Moments (VASP)" href="tutorial.magnetic_moments.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> pychemia
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1.Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.First_steps.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="4.GlobalMinimization.html">Global Minimization with Metaheuristics</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.ljclusters.html">Global Minimimization of Lennard-Jones Clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.structural_search.html">PyChemia Software Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.magnetic_moments.html">Optimization of Magnetic Moments (VASP)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Global optimization of correlation matrices for DFT+U (Abinit)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-variable-dmatpawu">The variable dmatpawu</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-population">The population</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pychemia</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="4.GlobalMinimization.html">Global Minimization with Metaheuristics</a> &raquo;</li>
        
      <li>Global optimization of correlation matrices for DFT+U (Abinit)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial.orbitaldftu.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="global-optimization-of-correlation-matrices-for-dft-u-abinit">
<h1>Global optimization of correlation matrices for DFT+U (Abinit)<a class="headerlink" href="#global-optimization-of-correlation-matrices-for-dft-u-abinit" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-variable-dmatpawu">
<h2>The variable dmatpawu<a class="headerlink" href="#the-variable-dmatpawu" title="Permalink to this headline">¶</a></h2>
<p>The objective of this global search is finding the optimal values for the density matrices in DFT+U.
ABINIT allows to locally optimize the density matrices from a given initial value.
The initial density matrices used in LDA+U are kept fixed during the first <cite>usedmatpu</cite> SCF iterations.
For SCF iterations beyond that, the density matrices change. The challenge here is that from a given
initial set of density matrices the system gets easily trapped into a local minimun, the usual procedure
then is to start from several initial options hoping to reach the global minimum at some point.</p>
<p>A global minimizer takes the responsability of efficiently explore the configuration space of the problem.
PyChemia implements several global searchers as we saw on previous tutorials. Those global searchers joined
by an efficient evaluation infraestructure allows many evaluations being perform without human assistance and an
effective chance of reaching a global minimum if the search is long enough.</p>
<p>For this tutorial consider the following problem:</p>
<blockquote>
<div>‘pychemia/test/data/abinit_dmatpaw/abinit.in’.</div></blockquote>
<p>First, we can read the abinit input and access the contents of the variable ‘dmatpawu’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pychemia</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">pychemia_path</span> <span class="o">=</span> <span class="n">pychemia</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">abiinput</span> <span class="o">=</span> <span class="n">pychemia</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">abinit</span><span class="o">.</span><span class="n">InputVariables</span><span class="p">(</span><span class="n">pychemia_path</span> <span class="o">+</span> <span class="s1">&#39;/test/data/abinit_dmatpawu/abinit.in&#39;</span><span class="p">)</span>
<span class="n">dmatpawu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">abiinput</span><span class="p">[</span><span class="s1">&#39;dmatpawu&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>The variable ‘dmatpawu’ stores the contents of 4 5x5 matrices, the correlation matrices for the corresponding 4 Co atoms
in the crystal. The matrices can be converted into a numpy array with shape (4, 5, 5) and they look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[[</span> <span class="mf">0.06256</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.01218</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.481</span>  <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.45877</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.01218</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.07148</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.45877</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.481</span>  <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.94038</span><span class="p">]],</span>

       <span class="p">[[</span> <span class="mf">0.97852</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.00305</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.95493</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.00449</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.00305</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.98115</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.00449</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.95493</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.95168</span><span class="p">]],</span>

       <span class="p">[[</span> <span class="mf">0.97852</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.00305</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.95493</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.00449</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.00305</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.98115</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.00449</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.95493</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.95168</span><span class="p">]],</span>

       <span class="p">[[</span> <span class="mf">0.06256</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.01218</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.481</span>  <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.45877</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.01218</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.07148</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.45877</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.481</span>  <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.94038</span><span class="p">]]])</span>
</pre></div>
</div>
<p>The objective is to find the set of correlation matrices that minimize the energy. Those are density matrices so even
if we have 100 numbers, any set of numbers is a valid set of correlation matrices. We will now convert this set of
matrices into a reduced set of variables that can be treated independently.</p>
<p>A correlation matrix can be express as the following product:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">R</span><span class="o">*</span><span class="n">O</span><span class="o">*</span><span class="n">R</span><span class="o">^</span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p>Where R is a rotation matrix, O is a diagonal matrix with a trace that is the total number of electrons correlated.
We need to find a set of independent variables to recreate any correlation matrix. We know that not any arbitrary set
of 25 numbers is a good rotation matrix. However, a 5x5 rotation matrix can be effectively decomposed into 10 independent
numbers, the so called “Generalized Euler angles”, this set of angles reduces the 25 values from a 5x5 rotation matrix
into 10 independent variables. We should also be aware that the occupations on the diagonal of the matrix ‘O’ are not
exactly integers, we will account for the small differences into a separate set of values. With those premises a 5x5
correlation matrix is converted into a set with 10 euler angles, 5 occupations and 5 deltas. This is done by the
routines ‘dmatpawu2params’ and ‘params2dmatpawu’ that allow us to go back and forward from the set of correlation
matrices into the set of ‘euler_angles’, intger ‘occupations’ and the small ‘deltas’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="n">pychemia</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">orbitaldftu</span><span class="o">.</span><span class="n">dmatpawu2params</span><span class="p">(</span><span class="n">dmatpawu</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>The variable ‘params’ is a dictionary with values for ‘occupations’, ‘deltas’ and ‘euler_angles’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;deltas&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span> <span class="mf">0.02223</span> <span class="p">,</span>  <span class="mf">0.054049</span><span class="p">,</span>  <span class="mf">0.079991</span><span class="p">,</span>  <span class="mf">0.06023</span> <span class="p">,</span>  <span class="mf">0.05962</span> <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.04956</span> <span class="p">,</span>  <span class="mf">0.04832</span> <span class="p">,</span>  <span class="mf">0.04058</span> <span class="p">,</span>  <span class="mf">0.023486</span><span class="p">,</span>  <span class="mf">0.016844</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.04956</span> <span class="p">,</span>  <span class="mf">0.04832</span> <span class="p">,</span>  <span class="mf">0.04058</span> <span class="p">,</span>  <span class="mf">0.023486</span><span class="p">,</span>  <span class="mf">0.016844</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.02223</span> <span class="p">,</span>  <span class="mf">0.054049</span><span class="p">,</span>  <span class="mf">0.079991</span><span class="p">,</span>  <span class="mf">0.06023</span> <span class="p">,</span>  <span class="mf">0.05962</span> <span class="p">]]),</span>
 <span class="s1">&#39;euler_angles&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span> <span class="mf">0.</span>      <span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span>  <span class="mf">0.785398</span><span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span>
          <span class="mf">0.</span>      <span class="p">,</span> <span class="o">-</span><span class="mf">0.609893</span><span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span> <span class="o">-</span><span class="mf">1.570796</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.581865</span><span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span> <span class="o">-</span><span class="mf">1.570796</span><span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span>  <span class="mf">0.785398</span><span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span>
          <span class="mf">1.570796</span><span class="p">,</span>  <span class="mf">1.570796</span><span class="p">,</span>  <span class="mf">1.570796</span><span class="p">,</span>  <span class="mf">3.141593</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.581865</span><span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span>  <span class="mf">1.570796</span><span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span>  <span class="mf">0.785398</span><span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span>
          <span class="mf">1.570796</span><span class="p">,</span>  <span class="mf">1.570796</span><span class="p">,</span>  <span class="mf">1.570796</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>      <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>      <span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span>  <span class="mf">0.785398</span><span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span>
          <span class="mf">0.</span>      <span class="p">,</span> <span class="o">-</span><span class="mf">0.609893</span><span class="p">,</span>  <span class="mf">0.</span>      <span class="p">,</span>  <span class="mf">1.570796</span><span class="p">]]),</span>
 <span class="s1">&#39;ndim&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
 <span class="s1">&#39;num_matrices&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
 <span class="s1">&#39;occupations&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])}</span>
</pre></div>
</div>
<p>This is in fact the set of independent variables that we can use to optimize the correlation using a global searcher.
We can also go back and recover the correlation matrices using the inverse procedure, ie, from the dictionary params
recover the correlation matrices:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dmatpawu_new</span> <span class="o">=</span> <span class="n">pychemia</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">orbitaldftu</span><span class="o">.</span><span class="n">params2dmatpawu</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>The dmatpawu is recovered from the values stored in ‘params’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[[</span> <span class="mf">0.06256</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.01218</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.481</span>  <span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.45877</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.01218</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.07148</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.45877</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.481</span>  <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.94038</span><span class="p">]],</span>

       <span class="p">[[</span> <span class="mf">0.97852</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.00305</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.95493</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.00449</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.00305</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.98115</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.00449</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.95493</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.95168</span><span class="p">]],</span>

       <span class="p">[[</span> <span class="mf">0.97852</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.00305</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.95493</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.00449</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.00305</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.98115</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.00449</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.95493</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.95168</span><span class="p">]],</span>

       <span class="p">[[</span> <span class="mf">0.06256</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.01218</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.481</span>  <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.45877</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.01218</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.07148</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">0.45877</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.481</span>  <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.94038</span><span class="p">]]])</span>
</pre></div>
</div>
<p>Each correlation matrix contains 25 values, using the procedure above, we reduce this number to 20: 10 euler angles, 5
integer occupations and 5 deltas. The values of deltas can be ignored for the purpose of the global searcher and the
occupations are contrained by the condition that their sum must be the equal to the number of electrons in the
correlated orbital. We have now the ingredients to move into the next step, create a population of correlation matrices.</p>
</div>
<div class="section" id="the-population">
<h2>The population<a class="headerlink" href="#the-population" title="Permalink to this headline">¶</a></h2>
<p>The most simple way of creating the population requires just the name of the mongo database to be created and one abinit
input file. The relevant information to setup the search will be infered from the contents of the abinit input file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">popu</span><span class="o">=</span><span class="n">pychemia</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">orbitaldftu</span><span class="o">.</span><span class="n">OrbitalDFTU</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">abinit_input</span><span class="o">=</span><span class="n">pychemia_path</span> <span class="o">+</span>
                                                    <span class="s1">&#39;/test/data/abinit_dmatpawu/abinit.in&#39;</span><span class="p">)</span>

<span class="n">Orbital</span> <span class="n">population</span><span class="p">:</span>
<span class="n">Species</span> <span class="p">[</span><span class="n">znucl</span><span class="p">]:</span> <span class="p">[</span><span class="mi">19</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">Orbitals</span> <span class="n">corrected</span><span class="p">:</span>
 <span class="mi">19</span> <span class="p">:</span> <span class="kc">False</span>
 <span class="mi">27</span> <span class="p">:</span> <span class="kc">True</span> <span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
  <span class="mi">9</span> <span class="p">:</span> <span class="kc">False</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">atoms</span> <span class="n">where</span> <span class="n">DFT</span><span class="o">+</span><span class="n">U</span> <span class="ow">is</span> <span class="n">applied</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">Correlation</span> <span class="n">of</span> <span class="s1">&#39;d&#39;</span> <span class="n">orbitals</span>
<span class="n">Variables</span> <span class="n">controling</span> <span class="n">the</span> <span class="n">total</span> <span class="n">number</span> <span class="n">of</span> <span class="n">matrices</span>
<span class="n">nsppol</span> <span class="p">:</span> <span class="mi">1</span>
<span class="n">nspinor</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">nspden</span> <span class="p">:</span> <span class="mi">2</span>
<span class="n">Total</span> <span class="n">number</span> <span class="n">of</span> <span class="n">matrices</span> <span class="n">expected</span> <span class="n">on</span> <span class="n">dmatpawu</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">electrons</span> <span class="k">for</span> <span class="n">each</span> <span class="n">correlation</span> <span class="n">matrix</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">independent</span> <span class="n">matrices</span><span class="p">:</span> <span class="mi">4</span>
</pre></div>
</div>
<p>Create random correlation matrices can be done with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">popu</span><span class="o">.</span><span class="n">add_random</span><span class="p">()</span>
</pre></div>
</div>
<p>The return is the Indentifier of the new entry on the database.
Also a set of new random correlation matrices can be created with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">popu</span><span class="o">.</span><span class="n">random_population</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
<p>We have the basic ingredients for creating the first population for the global searcher.
How the correlation matrices are evaluated is out of scope of the population and depends on the particularities of the
machines where Abinit is used to evaluate them. We will move our focus to the methods needed to produced new correlation
matrices based on the results of a given set of correlation matrices.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="tutorial.magnetic_moments.html" class="btn btn-neutral" title="Optimization of Magnetic Moments (VASP)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Guillermo Avendano-Franco.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>