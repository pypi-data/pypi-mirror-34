from bs4 import BeautifulSoup as BS
from DrMoriaty.utils.log import gprint, rprint, colored
import requests

mode = "thread"
thread = 20

def usage():
    gprint("get http banner's title")

def test_single(url, ssl=False):
    if ssl:
        u = 'https://' + url
    else:
        u = 'http://' + url
    try:
        res = requests.get(u, timeout=10)
        if res.status_code == 200:
            t = BS(res.text, 'html.parser')("title")[0].text
            if isinstance(t, bytes):
                t = t.decode(res.encoding, 'ignore')
            gprint(u, t)
    except Exception as e:
        rprint(url, colored(e, 'red'))

def test(targets):
    hosts = []
    for ii in targets.ports.split("/"):
        hosts.append(targets.ip + ":" + ii)
    for url in hosts:
        test_single(url)