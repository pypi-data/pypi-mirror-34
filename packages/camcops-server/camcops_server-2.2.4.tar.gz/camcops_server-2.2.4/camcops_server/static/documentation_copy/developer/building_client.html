
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>16.2. Building the CamCOPS client &#8212; CamCOPS 2.2.4 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/camcops_docs.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="16.3. C++ code style used" href="cpp_code_style.html" />
    <link rel="prev" title="16.1. Creating tasks" href="../client/creating_tasks.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="cpp_code_style.html" title="16.3. C++ code style used"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../client/creating_tasks.html" title="16.1. Creating tasks"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CamCOPS 2.2.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">16. Developer notes</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="building-the-camcops-client">
<h1>16.2. Building the CamCOPS client<a class="headerlink" href="#building-the-camcops-client" title="Permalink to this headline">¶</a></h1>
<div class="section" id="prerequisites">
<h2>16.2.1. Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>You will need <a class="reference external" href="https://www.qt.io/">Qt</a> (with Qt Creator) and you will need to build a copy of Qt
from source using the CamCOPS <a class="reference internal" href="development_command_line.html#build-qt"><span class="std std-ref">build_qt.py</span></a> tool.</p>
</div>
<div class="section" id="qt-versions">
<h2>16.2.2. Qt versions<a class="headerlink" href="#qt-versions" title="Permalink to this headline">¶</a></h2>
<p>Assuming you set your qt_local_build directory to <code class="docutils literal notranslate"><span class="pre">~/dev/qt_local_build</span></code>, the
<code class="docutils literal notranslate"><span class="pre">build_qt.py</span></code> script should generate a series of <code class="docutils literal notranslate"><span class="pre">qmake</span></code> (or, under
Windows, <code class="docutils literal notranslate"><span class="pre">qmake.exe</span></code>) files within that directory:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Operating system</th>
<th class="head">qmake</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Linux 64-bit</td>
<td>qt_linux_x86_64_install/bin/qmake</td>
</tr>
<tr class="row-odd"><td>Android (ARM)</td>
<td>qt_android_armv7_install/bin/qmake</td>
</tr>
<tr class="row-even"><td>Android emulator</td>
<td>qt_android_x86_32_install/bin/qmake</td>
</tr>
<tr class="row-odd"><td>Mac OS/X 64-bit</td>
<td>qt_osx_x86_64_install/bin/qmake</td>
</tr>
<tr class="row-even"><td>iOS (ARM)</td>
<td>qt_ios_armv8_64_install/bin/qmake</td>
</tr>
<tr class="row-odd"><td>iOS Simulator</td>
<td>qt_ios_x86_64_install/bin/qmake</td>
</tr>
<tr class="row-even"><td>Windows 32-bit</td>
<td>qt_windows_x86_32_install/bin/qmake</td>
</tr>
<tr class="row-odd"><td>Windows 64-bit</td>
<td>qt_windows_x86_64_install/bin/qmake</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="qt-kits">
<h2>16.2.3. Qt kits<a class="headerlink" href="#qt-kits" title="Permalink to this headline">¶</a></h2>
<p>Options last checked against Qt Creator 4.6.2 (built June 2018).</p>
<p><strong>Custom_Linux_x86_64</strong></p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head stub">Option</th>
<th class="head">Setting</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><th class="stub">Name</th>
<td><code class="docutils literal notranslate"><span class="pre">Custom_Linux_x86_64</span></code></td>
</tr>
<tr class="row-odd"><th class="stub">File system name</th>
<td>&#160;</td>
</tr>
<tr class="row-even"><th class="stub">Device type</th>
<td>Desktop</td>
</tr>
<tr class="row-odd"><th class="stub">Device</th>
<td>Local PC (default for Desktop)</td>
</tr>
<tr class="row-even"><th class="stub">Sysroot</th>
<td>&#160;</td>
</tr>
<tr class="row-odd"><th class="stub">Compiler: C</th>
<td>GCC (C, x86 64bit in <code class="docutils literal notranslate"><span class="pre">/usr/bin</span></code>)</td>
</tr>
<tr class="row-even"><th class="stub">Compiler: C++</th>
<td>GCC (x86 64bit in <code class="docutils literal notranslate"><span class="pre">/usr/bin</span></code>)</td>
</tr>
<tr class="row-odd"><th class="stub">Environment</th>
<td>[not editable: “No changes to apply.”]</td>
</tr>
<tr class="row-even"><th class="stub">Debugger</th>
<td>System GDB at <code class="docutils literal notranslate"><span class="pre">/usr/bin/gdb</span></code></td>
</tr>
<tr class="row-odd"><th class="stub">Qt version</th>
<td><strong>THE “LINUX 64-BIT” ONE FROM QT VERSIONS, ABOVE</strong></td>
</tr>
<tr class="row-even"><th class="stub">Qt mkspec</th>
<td>&#160;</td>
</tr>
<tr class="row-odd"><th class="stub">CMake Tool</th>
<td>System CMake at <code class="docutils literal notranslate"><span class="pre">/usr/bin/cmake</span></code></td>
</tr>
<tr class="row-even"><th class="stub">CMake Generator</th>
<td>CodeBlocks - Unix Makefiles</td>
</tr>
<tr class="row-odd"><th class="stub">CMake Configuration</th>
<td>[not editable]</td>
</tr>
<tr class="row-even"><th class="stub">Additional Qbs Profile Settings</th>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><strong>Custom_Android_ARM</strong></p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head stub">Option</th>
<th class="head">Setting</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><th class="stub">Name</th>
<td><code class="docutils literal notranslate"><span class="pre">Custom_Android_ARM</span></code></td>
</tr>
<tr class="row-odd"><th class="stub">File system name</th>
<td>&#160;</td>
</tr>
<tr class="row-even"><th class="stub">Device type</th>
<td>Android Device</td>
</tr>
<tr class="row-odd"><th class="stub">Device</th>
<td>Run on Android (default for Android)</td>
</tr>
<tr class="row-even"><th class="stub">Sysroot</th>
<td>&#160;</td>
</tr>
<tr class="row-odd"><th class="stub">Compiler: C</th>
<td>&lt;No compiler&gt;</td>
</tr>
<tr class="row-even"><th class="stub">Compiler: C++</th>
<td>Android GCC (arm-4.9)</td>
</tr>
<tr class="row-odd"><th class="stub">Environment</th>
<td>[not editable: “No changes to apply.”]</td>
</tr>
<tr class="row-even"><th class="stub">Debugger</th>
<td>Android Debugger for Android GCC (arm-4.9)</td>
</tr>
<tr class="row-odd"><th class="stub">Qt version</th>
<td><strong>THE “ANDROID” ONE FROM QT VERSIONS, ABOVE</strong></td>
</tr>
<tr class="row-even"><th class="stub">Qt mkspec</th>
<td>&#160;</td>
</tr>
<tr class="row-odd"><th class="stub">CMake Tool</th>
<td>System CMake at <code class="docutils literal notranslate"><span class="pre">/usr/bin/cmake</span></code></td>
</tr>
<tr class="row-even"><th class="stub">CMake Generator</th>
<td>CodeBlocks - Unix Makefiles</td>
</tr>
<tr class="row-odd"><th class="stub">CMake Configuration</th>
<td>[not editable]</td>
</tr>
<tr class="row-even"><th class="stub">Additional Qbs Profile Settings</th>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><strong>Custom_Android_x86</strong> – NOT FULLY TESTED</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head stub">Option</th>
<th class="head">Setting</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><th class="stub">Name</th>
<td><code class="docutils literal notranslate"><span class="pre">Custom_Android_x86</span></code></td>
</tr>
<tr class="row-odd"><th class="stub">File system name</th>
<td>&#160;</td>
</tr>
<tr class="row-even"><th class="stub">Device type</th>
<td>Android Device</td>
</tr>
<tr class="row-odd"><th class="stub">Device</th>
<td>Run on Android (default for Android)</td>
</tr>
<tr class="row-even"><th class="stub">Sysroot</th>
<td>&#160;</td>
</tr>
<tr class="row-odd"><th class="stub">Compiler: C</th>
<td>&lt;No compiler&gt;</td>
</tr>
<tr class="row-even"><th class="stub">Compiler: C++</th>
<td>Android GCC (i686-4.9)</td>
</tr>
<tr class="row-odd"><th class="stub">Environment</th>
<td>[not editable: “No changes to apply.”]</td>
</tr>
<tr class="row-even"><th class="stub">Debugger</th>
<td>Android Debugger for Android GCC (i686-4.9)</td>
</tr>
<tr class="row-odd"><th class="stub">Qt version</th>
<td><strong>THE “ANDROID EMULATOR” ONE FROM QT VERSIONS, ABOVE</strong></td>
</tr>
<tr class="row-even"><th class="stub">Qt mkspec</th>
<td>&#160;</td>
</tr>
<tr class="row-odd"><th class="stub">CMake Tool</th>
<td>System CMake at <code class="docutils literal notranslate"><span class="pre">/usr/bin/cmake</span></code></td>
</tr>
<tr class="row-even"><th class="stub">CMake Generator</th>
<td>CodeBlocks - Unix Makefiles</td>
</tr>
<tr class="row-odd"><th class="stub">CMake Configuration</th>
<td>[not editable]</td>
</tr>
<tr class="row-even"><th class="stub">Additional Qbs Profile Settings</th>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><strong>Custom_Windows_x86_64</strong></p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head stub">Option</th>
<th class="head">Setting</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><th class="stub">Name</th>
<td><code class="docutils literal notranslate"><span class="pre">Custom_Windows_x86_64</span></code></td>
</tr>
<tr class="row-odd"><th class="stub">File system name</th>
<td>&#160;</td>
</tr>
<tr class="row-even"><th class="stub">Device type</th>
<td>Desktop</td>
</tr>
<tr class="row-odd"><th class="stub">Device</th>
<td>Local PC (default for Desktop)</td>
</tr>
<tr class="row-even"><th class="stub">Sysroot</th>
<td><code class="docutils literal notranslate"><span class="pre">[...]\qt_local_build\qt_windows_x86_64_install\bin</span></code></td>
</tr>
<tr class="row-odd"><th class="stub">Compiler: C</th>
<td>Microsoft Visual C++ Compiler 14.0 (amd64)</td>
</tr>
<tr class="row-even"><th class="stub">Compiler: C++</th>
<td>Microsoft Visual C++ Compiler 14.0 (amd64)</td>
</tr>
<tr class="row-odd"><th class="stub">Environment</th>
<td>[not editable: “No changes to apply.”]</td>
</tr>
<tr class="row-even"><th class="stub">Debugger</th>
<td>Auto-detected CDB at <code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files</span> <span class="pre">(x86)\Windows</span> <span class="pre">Kits\10\Debuggers\x64\cdb.exe</span></code></td>
</tr>
<tr class="row-odd"><th class="stub">Qt version</th>
<td><strong>THE “WINDOWS 64-BIT” ONE FROM QT VERSIONS, ABOVE</strong></td>
</tr>
<tr class="row-even"><th class="stub">Qt mkspec</th>
<td>&#160;</td>
</tr>
<tr class="row-odd"><th class="stub">CMake Tool</th>
<td>System CMake at <code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files</span> <span class="pre">(x86)\CMake\bin\cmake.exe</span></code></td>
</tr>
<tr class="row-even"><th class="stub">CMake Generator</th>
<td>CodeBlocks - MinGW Makefiles, Platform: &lt;none&gt;, Toolset: &lt;none&gt;</td>
</tr>
<tr class="row-odd"><th class="stub">CMake Configuration</th>
<td><code class="docutils literal notranslate"><span class="pre">CMAKE_CXX_COMPILER:STRING=%{Compiler:Executable:Cxx}</span></code>
<code class="docutils literal notranslate"><span class="pre">CMAKE_C_COMPILER:STRING=%{Compiler:Executable:C}</span></code>
<code class="docutils literal notranslate"><span class="pre">CMAKE_PREFIX_PATH:STRING=%{Qt:QT_INSTALL_PREFIX}</span></code>
<code class="docutils literal notranslate"><span class="pre">QT_QMAKE_EXECUTABLE:STRING=%{Qt:qmakeExecutable}</span></code></td>
</tr>
<tr class="row-even"><th class="stub">Additional Qbs Profile Settings</th>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="build-settings">
<h2>16.2.4. Build settings<a class="headerlink" href="#build-settings" title="Permalink to this headline">¶</a></h2>
<p>… let’s put them in a <code class="docutils literal notranslate"><span class="pre">camcops.pro.shared</span></code> file:
<a class="reference external" href="http://doc.qt.io/qtcreator/creator-sharing-project-settings.html">http://doc.qt.io/qtcreator/creator-sharing-project-settings.html</a></p>
<div class="section" id="general">
<h3>16.2.4.1. General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use defaults, except everywhere you see <span class="menuselection">Build Settings ‣
Build Steps ‣ Make ‣ Make arguments</span>, add <code class="docutils literal notranslate"><span class="pre">-j</span> <span class="pre">8</span></code> for an
8-CPU machine to get it compiling in parallel.<ul>
<li>To save this effort, set <code class="docutils literal notranslate"><span class="pre">MAKEFLAGS=&quot;-j8&quot;</span></code> in your user environment (e.g.
in <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code>, or <code class="docutils literal notranslate"><span class="pre">~/.profile</span></code>); see
<a class="reference external" href="https://stackoverflow.com/questions/8860712/setting-default-make-options-for-qt-creator">https://stackoverflow.com/questions/8860712/setting-default-make-options-for-qt-creator</a>.
HOWEVER, Qt Creator doesn’t seem to read that environment variable for me.
Not sure why!</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="android">
<h3>16.2.4.2. Android<a class="headerlink" href="#android" title="Permalink to this headline">¶</a></h3>
<p>Under <span class="menuselection">Build Settings ‣ Build Steps ‣ Build Android APK</span>:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head stub">Option</th>
<th class="head">Setting</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><th class="stub"><span class="menuselection">Application ‣ Android build SDK</span></th>
<td><strong>PREVIOUSLY:</strong> android-23 [= default].
<strong>NOW:</strong> android-28 [= default].</td>
</tr>
<tr class="row-odd"><th class="stub"><span class="menuselection">Sign package ‣ Keystore</span></th>
<td><code class="docutils literal notranslate"><span class="pre">~/Documents/CamCOPS/android_keystore/CAMCOPS_ANDROID_KEYSTORE.keystore</span></code>
[NB not part of published code, obviously!]</td>
</tr>
<tr class="row-even"><th class="stub"><span class="menuselection">Sign package ‣ Sign package</span></th>
<td>Yes (at least for release versions)</td>
</tr>
<tr class="row-odd"><th class="stub"><span class="menuselection">Advanced actions ‣ Use Ministro service to
install Qt</span></th>
<td>Do NOT tick. (Formerly, before 2018-06-25, this was
<span class="menuselection">Qt deployment ‣ Bundle Qt libraries in APK</span>. The
objective remains to bundle Qt, not to install it via Ministro.)</td>
</tr>
<tr class="row-even"><th class="stub">Additional libraries</th>
<td><code class="docutils literal notranslate"><span class="pre">~/dev/qt_local_build/openssl_android_armv7_build/openssl-1.1.0g/libcrypto.so</span></code>
<code class="docutils literal notranslate"><span class="pre">~/dev/qt_local_build/openssl_android_armv7_build/openssl-1.1.0g/libssl.so</span></code></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Then in the file <code class="docutils literal notranslate"><span class="pre">AndroidManifest.xml</span></code> (which Qt Creator has a custom editor
for):</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head stub">Option</th>
<th class="head">Setting</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><th class="stub">Package name</th>
<td>org.camcops.camcops</td>
</tr>
<tr class="row-odd"><th class="stub">Version code</th>
<td>[integer; may as well use consecutive]</td>
</tr>
<tr class="row-even"><th class="stub">Version name</th>
<td>[string]</td>
</tr>
<tr class="row-odd"><th class="stub">Minimum required SDK</th>
<td>API 16: Android 4.1, 4.1.1 [default]</td>
</tr>
<tr class="row-even"><th class="stub">Target SDK</th>
<td><strong>WAS:</strong> API 23: Android 6.0 [default].
<strong>AS OF 2018-06-25:</strong> API 26: Android 8.0 [Google Play Store
requires this soon].
<strong>DOWNGRADED AGAIN 2018-07-16: OpenSSL problems.</strong> Probably because
you have to rebuild OpenSSL for Android (see
<code class="docutils literal notranslate"><span class="pre">DEFAULT_ANDROID_API_NUM</span></code> in <code class="docutils literal notranslate"><span class="pre">build_qt.py</span></code>).</td>
</tr>
<tr class="row-odd"><th class="stub">Application name</th>
<td>CamCOPS</td>
</tr>
<tr class="row-even"><th class="stub">Activity name</th>
<td>CamCOPS</td>
</tr>
<tr class="row-odd"><th class="stub">Run</th>
<td>camcops</td>
</tr>
<tr class="row-even"><th class="stub">Application icon</th>
<td>[icon]</td>
</tr>
<tr class="row-odd"><th class="stub">Include default permissions for Qt modules</th>
<td>[tick]</td>
</tr>
<tr class="row-even"><th class="stub">Include default features for Qt modules</th>
<td>[tick]</td>
</tr>
<tr class="row-odd"><th class="stub">Boxes for other permissions</th>
<td>[no other specific permission requested]</td>
</tr>
</tbody>
</table>
<p>But then you must also edit <code class="docutils literal notranslate"><span class="pre">AndroidManifest.xml</span></code> manually to include the
line:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;meta-data android:name=&quot;android.app.load_local_libs&quot; android:value=&quot;-- %%INSERT_LOCAL_LIBS%% --:lib/libssl.so:lib/libcrypto.so&quot;/&gt;
Note this bit:                                                                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p>For versions, see:</p>
<ul class="simple">
<li><a class="reference external" href="https://developer.android.com/guide/topics/manifest/manifest-element.html">https://developer.android.com/guide/topics/manifest/manifest-element.html</a></li>
<li><a class="reference external" href="https://developer.android.com/studio/publish/versioning.html">https://developer.android.com/studio/publish/versioning.html</a></li>
</ul>
<p>If you run this without a keystore, it produces a debug build (e.g.
<code class="docutils literal notranslate"><span class="pre">QtApp-debug.apk</span></code>). If you run it with a keystore/signature, it produces
<code class="docutils literal notranslate"><span class="pre">android-build-release-signed.apk</span></code> (formerly <code class="docutils literal notranslate"><span class="pre">QtApp-release-signed.apk</span></code>).
The APK name is fixed at this point
(<a class="reference external" href="https://forum.qt.io/topic/43329/qt-5-3-1-qtcreator-rename-qtapp-debug-apk-to-myapp">https://forum.qt.io/topic/43329/qt-5-3-1-qtcreator-rename-qtapp-debug-apk-to-myapp</a>).
We can rename the APK if we want, or just upload to Google Play, distribute,
etc.</p>
</div>
<div class="section" id="linux">
<h3>16.2.4.3. Linux<a class="headerlink" href="#linux" title="Permalink to this headline">¶</a></h3>
<p>Under <span class="menuselection">Build Settings ‣ Build Environment`</span>, set e.g.
<code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH=/home/rudolf/dev/qt_local_build/openssl_linux_x86_64_build/openssl-1.1.0g/</span></code></p>
<div class="section" id="google-play-store-settings">
<h4>16.2.4.3.1. Google Play Store settings<a class="headerlink" href="#google-play-store-settings" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Developer URL is <a class="reference external" href="https://play.google.com/apps/publish">https://play.google.com/apps/publish</a>
–&gt; pick your application
–&gt; e.g. Release management / App releases</p>
</li>
<li><p class="first">App category: “Utility/other”.</p>
</li>
<li><p class="first">Content rating: by Google’s definitions, CamCOPS hits criteria for references
to illegal drugs (e.g. Deakin1HealthReview, and when strings are available,
the various drug abuse scoring scales). Did not meet Google Play’s criteria
for sex, violence, etc.</p>
</li>
<li><p class="first">Note that “Pending publication” means you’re waiting for Google Play to sort
itself out, not that you have to do anything.</p>
</li>
<li><p class="first">Note re versions:</p>
<ul class="simple">
<li>As above, the AndroidManifest.xml has an INTEGER version, so we may as
well use consecutive numbers. See the release history below.</li>
</ul>
<p>The Google Developer site will check the version codes.
Failed uploads can sometimes block that version number.</p>
</li>
<li><p class="first">You upload a new version with “App releases” / “Create Release”.</p>
</li>
<li><p class="first">Note also that if you try to install the .apk directly to a device that’s
had an installation from Google Play Store, you’ll get the error
INSTALL_FAILED_UPDATE_INCOMPATIBLE (I think). Or if you mix debug/release
versions.</p>
</li>
<li><p class="first">Finally, note that there can be a significant delay between uploading a new
release and client devices seeing it on Google Play (or even being able to
see it at <a class="reference external" href="https://play.google.com/store">https://play.google.com/store</a>, or via the direct link at
<a class="reference external" href="https://play.google.com/store/apps/details?id=org.camcops.camcops">https://play.google.com/store/apps/details?id=org.camcops.camcops</a>). Perhaps
10 minutes to the main web site?</p>
</li>
</ul>
</div>
</div>
<div class="section" id="google-play-store-release-history">
<h3>16.2.4.4. Google Play Store release history<a class="headerlink" href="#google-play-store-release-history" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="21%" />
<col width="21%" />
<col width="18%" />
<col width="12%" />
<col width="11%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Google Play</th>
<th class="head">AndroidManifest.xml</th>
<th class="head">AndroidManifest.xml</th>
<th class="head">To Play Store on</th>
<th class="head">Minimum API</th>
<th class="head">Target</th>
</tr>
<tr class="row-even"><th class="head">Store release</th>
<th class="head">version code</th>
<th class="head">name</th>
<th class="head">&#160;</th>
<th class="head">Android</th>
<th class="head">Android</th>
</tr>
<tr class="row-odd"><th class="head">name</th>
<th class="head">&#160;</th>
<th class="head">&#160;</th>
<th class="head">&#160;</th>
<th class="head">API</th>
<th class="head">API</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2.0.1 (beta)</td>
<td>2</td>
<td>2.0.1</td>
<td>2017-08-04</td>
<td>16</td>
<td>23</td>
</tr>
<tr class="row-odd"><td>2.0.4 (beta)</td>
<td>3</td>
<td>2.0.4</td>
<td>2017-10-22</td>
<td>16</td>
<td>23</td>
</tr>
<tr class="row-even"><td>2.2.3 (beta)</td>
<td>5</td>
<td>2.2.3</td>
<td>2018-06-25</td>
<td>16</td>
<td>26</td>
</tr>
<tr class="row-odd"><td>2.2.4 (beta)</td>
<td>6</td>
<td>2.2.4</td>
<td>2018-07-18</td>
<td>23</td>
<td>26</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="notes">
<h2>16.2.5. Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="version-constraints-for-third-party-software">
<h3>16.2.5.1. Version constraints for third-party software<a class="headerlink" href="#version-constraints-for-third-party-software" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>OpenSSL 1.0.x has long-term support and 1.1.x is the current release.</li>
<li>OpenSSL 1.0.2h didn’t compile under 64-bit Windows, whereas OpenSSL 1.1.x
did.</li>
<li>OpenSSL 1.1.x requires Qt 5.10 or higher
(<a class="reference external" href="https://bugreports.qt.io/browse/QTBUG-52905">https://bugreports.qt.io/browse/QTBUG-52905</a>).</li>
<li>SQLCipher supports OpenSSL 1.1.0 as of SQLCipher 3.4.1
(<a class="reference external" href="https://discuss.zetetic.net/t/sqlcipher-3-4-1-release/1962">https://discuss.zetetic.net/t/sqlcipher-3-4-1-release/1962</a>).</li>
<li>Qt requires Android API ≥16 (<a class="reference external" href="http://doc.qt.io/qt-5/android-support.html">http://doc.qt.io/qt-5/android-support.html</a>).</li>
<li>Qt 5.11.1 does not compile with the <code class="docutils literal notranslate"><span class="pre">android-16</span></code> toolchain (specifically
its Bluetooth components). Qt looks for a Java package
<code class="docutils literal notranslate"><span class="pre">android.bluetooth.le</span></code>, which is the Bluetooth Low Energy component that
comes with Android SDK 18. So let’s try 18 as the minimum. That does compile.</li>
<li>Android libraries should be compiled for the same SDK version as
<code class="docutils literal notranslate"><span class="pre">minSdkVersion</span></code> in <code class="docutils literal notranslate"><span class="pre">AndroidManifest.xml</span></code> (see
<a class="reference external" href="https://stackoverflow.com/questions/21888052/what-is-the-relation-between-app-platform-androidminsdkversion-and-androidtar/41079462#41079462">https://stackoverflow.com/questions/21888052/what-is-the-relation-between-app-platform-androidminsdkversion-and-androidtar/41079462#41079462</a>,
and <a class="reference external" href="https://developer.android.com/ndk/guides/stable_apis">https://developer.android.com/ndk/guides/stable_apis</a>).</li>
<li>For whatever reasons, CamCOPS (v2.2.3-2.2.4) doesn’t run on Android 4.4.x
(API 18) but does run on 6.0 (API 23); intermediates untested.</li>
<li>Google Play store will require <code class="docutils literal notranslate"><span class="pre">targetSdkVersion</span></code> to be at least 26 from
2018-11-01
(<a class="reference external" href="https://developer.android.com/distribute/best-practices/develop/target-sdk">https://developer.android.com/distribute/best-practices/develop/target-sdk</a>).</li>
<li>Qt favour Android NDK r10e (the May 2015 release)
(<a class="reference external" href="http://doc.qt.io/qt-5/androidgs.html">http://doc.qt.io/qt-5/androidgs.html</a>) but r11c also seems to work fine.</li>
</ul>
</div>
<div class="section" id="id1">
<h3>16.2.5.2. Android<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">To build Android programs under Linux, also need:
<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">openjdk-8-jdk</span></code></p>
</li>
<li><p class="first">Configure your Android SDK/NDK and Java JDK at: <span class="menuselection">Tools ‣
Options ‣ Android</span>, or in newer versions of Qt Creator,
<span class="menuselection">Tools ‣ Options ‣ Devices ‣ Android ‣ Android
Settings</span>.</p>
</li>
<li><p class="first">Above Android API 23, linking to non-public libraries is prohibited, possibly
with exceptions for SSL/crypto.</p>
<ul class="simple">
<li><a class="reference external" href="https://android-developers.googleblog.com/2016/06/android-changes-for-ndk-developers.html">https://android-developers.googleblog.com/2016/06/android-changes-for-ndk-developers.html</a></li>
<li><a class="reference external" href="https://developer.android.com/about/versions/nougat/android-7.0-changes#ndk">https://developer.android.com/about/versions/nougat/android-7.0-changes#ndk</a></li>
</ul>
<p>I think this caused fatal problems for CamCOPS in 2018-07; not sure, but this
might explain it.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">Error:</span> <span class="pre">&quot;unsupported_android_version&quot;</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">translated</span></code>: see
<a class="reference external" href="https://bugreports.qt.io/browse/QTBUG-63952">https://bugreports.qt.io/browse/QTBUG-63952</a>. This error does not prevent you
from continuing.</p>
</li>
</ul>
</div>
<div class="section" id="debugging">
<h3>16.2.5.3. Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">DON’T FORGET to set up both Debug and Release (+/- Profile) builds.</p>
</li>
<li><p class="first">Phone USB debugging negotiation sometimes takes a while. On the Samsung
Galaxy phone, the alert light goes red when in Debug mode.</p>
</li>
<li><p class="first">If you lose the debugger windows in Qt Creator midway through a debug
session, press Ctrl-4.</p>
</li>
<li><p class="first">This error (with a variety of compiler names):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.../mkspecs/features/toolchain.prf(50): system(execute) requires one or two arguments.
Project ERROR: Cannot run compiler &#39;g++&#39;. Maybe you forgot to setup the environment?
</pre></div>
</div>
<p>means that you need to re-run qmake manually. It usually occurs if you delete
your build* directories.</p>
</li>
<li><p class="first">For debugging, consider install <a class="reference external" href="http://valgrind.org/">Valgrind</a>: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">valgrind</span></code></p>
</li>
</ul>
</div>
<div class="section" id="oddities">
<h3>16.2.5.4. Oddities<a class="headerlink" href="#oddities" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Sometimes you have to restart Qt creator after creating new build settings;
it loses its .pro file and won’t show the project, or complains of a missing
.pro file when you try to build.</li>
<li>The first build can be very slow as it compiles all the resources; this
usually looks like a process stuck compiling qrc_camcops.cpp to qrc_camcops.o</li>
<li>If an Android build fails for a bizarre reason (like garbage in a .java file
that looks like it’s been pre-supplied), delete the whole build directory,
which is not always removed by cleaning.</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table Of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/download.html">2. Downloading CamCOPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client/client_installation.html">3. Installing and configuring the client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client/client_using.html">4. Using the client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/server_front_end_general.html">5. Web site: general use</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tasks/_tasks_by_category.html">6. Tasks in CamCOPS by category</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tasks/_tasks_all.html">7. All tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client/client_troubleshooting.html">8. Troubleshooting client problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/server_installation.html">9. Installing CamCOPS on the server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/server_configuration.html">10. Configuring the server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/server_config_file.html">11. The CamCOPS server configuration file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/server_front_end_admin.html">12. Web site: admin functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/server_command_line.html">13. CamCOPS command-line tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/server_troubleshooting.html">14. Troubleshooting server problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../licences/licences.html">15. Licences</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">16. Developer notes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../client/creating_tasks.html">16.1. Creating tasks</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">16.2. Building the CamCOPS client</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp_code_style.html">16.3. C++ code style used</a></li>
<li class="toctree-l2"><a class="reference internal" href="design_notes.html">16.4. Design notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="development_command_line.html">16.5. Development command-line tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../misc/tcpip_ports.html">17. Common relevant TCP/IP ports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/linux_flavours.html">18. Linux flavours</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autodoc/_index.html">19. Automatic documentation of core server source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">20. Change log/history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq_known_problems.html">21. FAQ and known problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../to_do.html">22. Things to do</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wishlist.html">23. Wishlist and blue-sky thoughts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/local_info.html">24. Local configuration information</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../client/creating_tasks.html"
                        title="previous chapter">16.1. Creating tasks</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="cpp_code_style.html"
                        title="next chapter">16.3. C++ code style used</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/developer/building_client.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="cpp_code_style.html" title="16.3. C++ code style used"
             >next</a> |</li>
        <li class="right" >
          <a href="../client/creating_tasks.html" title="16.1. Creating tasks"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CamCOPS 2.2.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >16. Developer notes</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2018, Rudolf Cardinal.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>