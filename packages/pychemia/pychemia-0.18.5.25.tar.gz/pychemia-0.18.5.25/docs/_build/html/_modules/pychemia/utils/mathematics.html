

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pychemia.utils.mathematics &mdash; pychemia 0.1.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="pychemia 0.1.2 documentation" href="../../../index.html"/>
        <link rel="up" title="pychemia" href="../../pychemia.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> pychemia
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../1.Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../2.Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../3.First_steps.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../4.GlobalMinimization.html">Global Minimization with Metaheuristics</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pychemia</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../pychemia.html">pychemia</a> &raquo;</li>
        
      <li>pychemia.utils.mathematics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pychemia.utils.mathematics</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">fractions</span> <span class="k">import</span> <span class="n">gcd</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">sqrt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<div class="viewcode-block" id="length_vector"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.length_vector">[docs]</a><span class="k">def</span> <span class="nf">length_vector</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the length of a vector &#39;v&#39; in arbitrary number of dimensions</span>

<span class="sd">    :param v: (list, numpy.ndarray) Vector to compute length</span>

<span class="sd">    :rtype : (float) The lenght of the vector</span>

<span class="sd">    Examples</span>

<span class="sd">    &gt;&gt;&gt; length_vector([1, 2, 3])</span>
<span class="sd">    3.7416573867739413</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>


<div class="viewcode-block" id="length_vectors"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.length_vectors">[docs]</a><span class="k">def</span> <span class="nf">length_vectors</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the lengths of several vectors</span>
<span class="sd">    arranged as rows in a MxN matrix</span>

<span class="sd">    :param m: numpy.ndarray</span>

<span class="sd">    :rtype : numpy.ndarray</span>

<span class="sd">    Examples</span>
<span class="sd">    &gt;&gt;&gt; length_vectors([[1, 2, 3], [4, 5, 6], [7, 8, 9], [1, 0, 0], [0, 0, 2]])</span>
<span class="sd">    array([ 3.74165739,  8.77496439, 13.92838828,  1.        ,  2.        ])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="unit_vector"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.unit_vector">[docs]</a><span class="k">def</span> <span class="nf">unit_vector</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the unit vector of the vector.</span>
<span class="sd">    Arbitrary number of dimensions</span>

<span class="sd">    :param v: list, numpy.array</span>

<span class="sd">    :rtype : numpy.ndarray</span>

<span class="sd">    Examples</span>
<span class="sd">    &gt;&gt;&gt; a = unit_vector([1, 2, 3])</span>

<span class="sd">    &gt;&gt;&gt; a</span>
<span class="sd">    array([0.26726124, 0.53452248, 0.80178373])</span>

<span class="sd">    &gt;&gt;&gt; length_vector(a)</span>
<span class="sd">    1.0</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">length_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1E-10</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Vector is null&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">length_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span></div>


<div class="viewcode-block" id="unit_vectors"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.unit_vectors">[docs]</a><span class="k">def</span> <span class="nf">unit_vectors</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the unit vectors of a set</span>
<span class="sd">    of vectors arranged as rows in MxN matrix</span>

<span class="sd">    :param m: numpy.ndarray</span>

<span class="sd">    :rtype : numpy.ndarray</span>

<span class="sd">    Example</span>
<span class="sd">    &gt;&gt;&gt; from pychemia.utils.mathematics import *</span>

<span class="sd">    &gt;&gt;&gt; b = unit_vectors([[1, 2, 3], [4, 5, 6], [7, 8, 9], [1, 0, 0], [0, 0, 2]])</span>

<span class="sd">    &gt;&gt;&gt; b</span>
<span class="sd">    array([[0.26726124, 0.53452248, 0.80178373],</span>
<span class="sd">           [0.45584231, 0.56980288, 0.68376346],</span>
<span class="sd">           [0.50257071, 0.57436653, 0.64616234],</span>
<span class="sd">           [1.        , 0.        , 0.        ],</span>
<span class="sd">           [0.        , 0.        , 1.        ]])</span>

<span class="sd">    &gt;&gt;&gt; length_vectors(b)</span>
<span class="sd">    array([1., 1., 1., 1., 1.])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span></div>


<div class="viewcode-block" id="angle_vector"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.angle_vector">[docs]</a><span class="k">def</span> <span class="nf">angle_vector</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;rad&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the angle in radians (default) or degrees</span>
<span class="sd">    between vectors &#39;v1&#39; and &#39;v2&#39;::</span>

<span class="sd">    :param v1: (list, numpy.ndarray)</span>
<span class="sd">    :param v2: (list, numpy.ndarray)</span>
<span class="sd">    :param units: (str) : &#39;rad&#39; (default) Radians, &#39;deg&#39; Degrees</span>

<span class="sd">    :rtype : float</span>

<span class="sd">    Examples:</span>
<span class="sd">    &gt;&gt;&gt; angle_vector([1, 0, 0], [0, 1, 0])</span>
<span class="sd">    1.5707963267948966</span>
<span class="sd">    &gt;&gt;&gt; angle_vector([1, 0, 0], [1, 0, 0])</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; angle_vector([1, 0, 0], [-1, 0, 0])</span>
<span class="sd">    3.141592653589793</span>
<span class="sd">    &gt;&gt;&gt; angle_vector([1, 0, 0], [0, 1, 0], units=&#39;deg&#39;)</span>
<span class="sd">    90.0</span>
<span class="sd">    &gt;&gt;&gt; angle_vector([1, 0, 0], [-1, 0, 0], units=&#39;deg&#39;)</span>
<span class="sd">    180.0</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">units</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rad&#39;</span><span class="p">,</span> <span class="s1">&#39;deg&#39;</span><span class="p">])</span>

    <span class="n">v1_u</span> <span class="o">=</span> <span class="n">unit_vector</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
    <span class="n">v2_u</span> <span class="o">=</span> <span class="n">unit_vector</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
    <span class="n">dot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v1_u</span><span class="p">,</span> <span class="n">v2_u</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dot</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">dot</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">dot</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">angle</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">v1_u</span> <span class="o">==</span> <span class="n">v2_u</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;rad&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">angle</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;deg&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span></div>


<div class="viewcode-block" id="angle_between_vectors"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.angle_between_vectors">[docs]</a><span class="k">def</span> <span class="nf">angle_between_vectors</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">norms</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">norms</span><span class="p">[</span><span class="n">norms</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">dots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">norms</span>
    <span class="n">dots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">dots</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">dots</span><span class="p">[</span><span class="n">dots</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">norms</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">dots</span><span class="p">[</span><span class="n">norms</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">dots</span><span class="p">)</span></div>


<div class="viewcode-block" id="angle_vectors"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.angle_vectors">[docs]</a><span class="k">def</span> <span class="nf">angle_vectors</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;rad&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns all the angles for all the</span>
<span class="sd">    vectors arranged as rows in matrix &#39;m&#39;</span>

<span class="sd">    :param m: (numpy.ndarray)</span>
<span class="sd">    :param units: (str) : &#39;rad&#39; Radians, &#39;deg&#39; Degrees</span>

<span class="sd">    :rtype : numpy.ndarray</span>

<span class="sd">    Examples:</span>
<span class="sd">    &gt;&gt;&gt; import pprint</span>

<span class="sd">    &gt;&gt;&gt; a = angle_vectors([[1, 2, 3], [4, 5, 6], [7, 8, 9], [1, 0, 0], [0, 0, 2]])</span>

<span class="sd">    &gt;&gt;&gt; pprint.pprint(a)</span>
<span class="sd">    {(0, 1): 0.2257261285527342,</span>
<span class="sd">     (0, 2): 0.2858867976945072,</span>
<span class="sd">     (0, 3): 1.3002465638163236,</span>
<span class="sd">     (0, 4): 0.6405223126794245,</span>
<span class="sd">     (1, 2): 0.060160669141772885,</span>
<span class="sd">     (1, 3): 1.0974779950809703,</span>
<span class="sd">     (1, 4): 0.8178885561654512,</span>
<span class="sd">     (2, 3): 1.0442265974045177,</span>
<span class="sd">     (2, 4): 0.8682510378027637,</span>
<span class="sd">     (3, 4): 1.5707963267948966}</span>

<span class="sd">    &gt;&gt;&gt; a = angle_vectors([[1, 2, 3], [4, 5, 6], [7, 8, 9], [1, 0, 0], [0, 0, 2]], units=&#39;deg&#39;)</span>

<span class="sd">    &gt;&gt;&gt; pprint.pprint(a)</span>
<span class="sd">    {(0, 1): 12.933154491899135,</span>
<span class="sd">     (0, 2): 16.380106926405656,</span>
<span class="sd">     (0, 3): 74.498640433063,</span>
<span class="sd">     (0, 4): 36.69922520048988,</span>
<span class="sd">     (1, 2): 3.4469524345065143,</span>
<span class="sd">     (1, 3): 62.88085722661892,</span>
<span class="sd">     (1, 4): 46.86156238032894,</span>
<span class="sd">     (2, 3): 59.82977688658543,</span>
<span class="sd">     (2, 4): 49.74712002395206,</span>
<span class="sd">     (3, 4): 90.0}</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)),</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle_vector</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="distance"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.distance">[docs]</a><span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the vector v2-v1, the vector going from v1 to v2</span>
<span class="sd">    and the magnitude of that vector.</span>

<span class="sd">    :param v1: (list, numpy.ndarray)</span>
<span class="sd">    :param v2: (list, numpy.ndarray)</span>

<span class="sd">    :rtype : tuple</span>

<span class="sd">    Examples:</span>
<span class="sd">    &gt;&gt;&gt; distance([0, 0, 0, 1], [1, 0, 0, 0])</span>
<span class="sd">    (array([ 1,  0,  0, -1]), 1.4142135623730951)</span>
<span class="sd">    &gt;&gt;&gt; distance([-1, 0, 0], [1, 0, 0])</span>
<span class="sd">    (array([2, 0, 0]), 2.0)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">length_vector</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span></div>


<div class="viewcode-block" id="distances"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.distances">[docs]</a><span class="k">def</span> <span class="nf">distances</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return all the distances for all possible combinations of the row vectors in matrix m</span>

<span class="sd">    :param m: (list, numpy.ndarray)</span>

<span class="sd">    :rtype : dict</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; import pprint</span>

<span class="sd">    &gt;&gt;&gt; pprint.pprint(distances([[1, 2, 3], [4, 5, 6], [7, 8, 9], [1, 0, 0], [0, 0, 2]]))</span>
<span class="sd">    {(0, 1): (array([3, 3, 3]), 5.196152422706632),</span>
<span class="sd">     (0, 2): (array([6, 6, 6]), 10.392304845413264),</span>
<span class="sd">     (0, 3): (array([ 0, -2, -3]), 3.605551275463989),</span>
<span class="sd">     (0, 4): (array([-1, -2, -1]), 2.449489742783178),</span>
<span class="sd">     (1, 2): (array([3, 3, 3]), 5.196152422706632),</span>
<span class="sd">     (1, 3): (array([-3, -5, -6]), 8.366600265340756),</span>
<span class="sd">     (1, 4): (array([-4, -5, -4]), 7.54983443527075),</span>
<span class="sd">     (2, 3): (array([-6, -8, -9]), 13.45362404707371),</span>
<span class="sd">     (2, 4): (array([-7, -8, -7]), 12.727922061357855),</span>
<span class="sd">     (3, 4): (array([-1,  0,  2]), 2.23606797749979)}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)),</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="wrap2_pmhalf"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.wrap2_pmhalf">[docs]</a><span class="k">def</span> <span class="nf">wrap2_pmhalf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wraps a number or array in the interval ]-1/2, 1/2] values = -1/2 will be wrapped  to 1/2</span>

<span class="sd">    :param x: (float) The number to be wrapped in the interval (-1/2, 1/2]</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; wrap2_pmhalf(-0.5)</span>
<span class="sd">    0.5</span>
<span class="sd">    &gt;&gt;&gt; wrap2_pmhalf(0.0)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; wrap2_pmhalf([-0.75, -0.5, -0.25, 0.0, 0.25, 0.5, 0.75])</span>
<span class="sd">    array([ 0.25,  0.5 , -0.25,  0.  ,  0.25,  0.5 , -0.25])</span>
<span class="sd">    &gt;&gt;&gt; wrap2_pmhalf([[-0.75, -0.5, -0.25], [0.25, 0.5, 0.75]])</span>
<span class="sd">    array([[ 0.25,  0.5 , -0.25],</span>
<span class="sd">           [ 0.25,  0.5 , -0.25]])</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="n">tol12</span> <span class="o">=</span> <span class="mf">1e-12</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="n">tol12</span><span class="p">)</span> <span class="o">%</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">tol12</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">num</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="n">tol12</span><span class="p">)</span> <span class="o">%</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">tol12</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">num2</span><span class="p">:</span> <span class="n">y</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">num2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol12</span> <span class="k">else</span> <span class="n">num2</span><span class="p">)(</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">wrap</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vec</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wrap</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="vector_set_perpendicular"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.vector_set_perpendicular">[docs]</a><span class="k">def</span> <span class="nf">vector_set_perpendicular</span><span class="p">(</span><span class="n">vector3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produces a set of three mutually perpendicular vectors</span>
<span class="sd">    The two other vectors will be unitary</span>

<span class="sd">    :return: (tuple) Two numpy arrays</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">unit_vector</span><span class="p">(</span><span class="n">vector3</span><span class="p">)</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">unit_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">unit_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="n">v3</span> <span class="o">=</span> <span class="n">unit_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">continue</span>
    <span class="c1"># print _np.dot(v1, v2)</span>
    <span class="c1"># print _np.dot(v1, v3)</span>
    <span class="c1"># print _np.dot(v2, v3)</span>

    <span class="c1"># assert (_np.abs(_np.dot(v1, v2)) &lt; 1E-15)</span>
    <span class="c1"># assert (_np.abs(_np.dot(v1, v3)) &lt; 1E-15)</span>
    <span class="c1"># assert (_np.abs(_np.dot(v2, v3)) &lt; 1E-15)</span>
    <span class="k">return</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span></div>


<div class="viewcode-block" id="matrix_from_eig"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.matrix_from_eig">[docs]</a><span class="k">def</span> <span class="nf">matrix_from_eig</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">lam1</span><span class="p">,</span> <span class="n">lam2</span><span class="p">,</span> <span class="n">lam3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given 3 eigenvectors and 3 eigenvalues, returns the</span>
<span class="sd">    matrix A that has those eigenvectors and eigenvalues.</span>

<span class="sd">    The matrix $A = P.D.P^{-1}$</span>

<span class="sd">    Where P is the column stack of eigenvectors and</span>
<span class="sd">    D is a diagonal matrix of eigevalues</span>

<span class="sd">    :param v1: First eigenvector</span>
<span class="sd">    :param v2: Second eigenvector</span>
<span class="sd">    :param v3: Third eigenvector</span>
<span class="sd">    :param lam1: First eigenvalue</span>
<span class="sd">    :param lam2: Second eigenvalue</span>
<span class="sd">    :param lam3: Third eigenvalue</span>
<span class="sd">    :return: (numpy.ndarray) The matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matrixp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">matrixd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="n">lam1</span><span class="p">,</span> <span class="n">lam2</span><span class="p">,</span> <span class="n">lam3</span><span class="p">])</span>
    <span class="n">matrixpinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">matrixp</span><span class="p">)</span>
    <span class="n">matrixa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">matrixp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">matrixd</span><span class="p">,</span> <span class="n">matrixpinv</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">matrixa</span></div>


<div class="viewcode-block" id="integral_gaussian"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.integral_gaussian">[docs]</a><span class="k">def</span> <span class="nf">integral_gaussian</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the integral of a gaussian centered</span>
<span class="sd">    in mu with a given sigma</span>
<span class="sd">    :param a:</span>
<span class="sd">    :param b:</span>
<span class="sd">    :param mu:</span>
<span class="sd">    :param sigma:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Integral from -\infty to a</span>
    <span class="n">val_floor</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">erf</span><span class="p">((</span><span class="n">a</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))))</span>

    <span class="c1"># Integral from -\infty to b</span>
    <span class="n">val_ceil</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">erf</span><span class="p">((</span><span class="n">b</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))))</span>

    <span class="k">return</span> <span class="n">val_ceil</span> <span class="o">-</span> <span class="n">val_floor</span></div>


<div class="viewcode-block" id="frexp10"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.frexp10">[docs]</a><span class="k">def</span> <span class="nf">frexp10</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">exp</span><span class="p">,</span> <span class="n">exp</span></div>


<div class="viewcode-block" id="round_small"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.round_small">[docs]</a><span class="k">def</span> <span class="nf">round_small</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">mantissa</span><span class="p">,</span> <span class="n">exponent</span> <span class="o">=</span> <span class="n">frexp10</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="n">mantissa</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">mantissa</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mantissa</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">exponent</span></div>


<div class="viewcode-block" id="sieve_atkin"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.sieve_atkin">[docs]</a><span class="k">def</span> <span class="nf">sieve_atkin</span><span class="p">(</span><span class="n">limit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes all prime numbers up to a &#39;limit&#39;</span>
<span class="sd">    using the Sieve of Atkin</span>

<span class="sd">    :param limit:</span>
<span class="sd">    :return:</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; p=sieve_atkin(300)</span>

<span class="sd">    &gt;&gt;&gt; len(p)</span>
<span class="sd">    63</span>
<span class="sd">    &gt;&gt;&gt; p[-1]</span>
<span class="sd">    293</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">sieve</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">limit</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">limit</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">limit</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">limit</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">==</span> <span class="mi">5</span><span class="p">):</span>
                <span class="n">sieve</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">sieve</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">limit</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">sieve</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">sieve</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">limit</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                <span class="n">sieve</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">sieve</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">limit</span><span class="p">))):</span>
        <span class="k">if</span> <span class="n">sieve</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">limit</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">):</span>
                <span class="n">sieve</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sieve</span><span class="p">[</span><span class="n">p</span><span class="p">]:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="trial_division"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.trial_division">[docs]</a><span class="k">def</span> <span class="nf">trial_division</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of the prime factors for a natural number</span>
<span class="sd">    uses the Sieve of Atkin as a list of primes</span>

<span class="sd">    :param n: (int) A natural number</span>

<span class="sd">    :rtype : (list)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">primes</span> <span class="o">=</span> <span class="n">sieve_atkin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">prime_factors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">primes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">*</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">%</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">prime_factors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">/=</span> <span class="n">p</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">prime_factors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">prime_factors</span></div>


<div class="viewcode-block" id="lcm"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.lcm">[docs]</a><span class="k">def</span> <span class="nf">lcm</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the Least Common Multiple</span>
<span class="sd">    the smallest positive integer that is divisible by both a and b</span>
<span class="sd">    :param a: (int)</span>
<span class="sd">    :param b: (int)</span>
<span class="sd">    :return: (int)</span>

<span class="sd">    :rtype : (int)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="n">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></div>


<div class="viewcode-block" id="shortest_triple_set"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.shortest_triple_set">[docs]</a><span class="k">def</span> <span class="nf">shortest_triple_set</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the smallest three numbers (a,b,c) such as</span>
<span class="sd">    a*b*c=n</span>
<span class="sd">    And a+b+c is as small as possible</span>

<span class="sd">    :param n:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># First Compute the prime factors</span>
    <span class="n">prime_factors</span> <span class="o">=</span> <span class="n">trial_division</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prime_factors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="c1"># No choice return the three numbers</span>
        <span class="k">return</span> <span class="n">prime_factors</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prime_factors</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="c1"># If there are less than 3 complete the set with ones</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">prime_factors</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">prime_factors</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">prime_factors</span>
        <span class="k">return</span> <span class="n">prime_factors</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">prime_factors</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># print factors</span>
            <span class="c1"># Complete a multiple of 6 and sum folding lowest with highest</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mi">1</span><span class="p">],</span> <span class="n">factors</span><span class="p">))</span>
            <span class="c1"># Take the first half</span>
            <span class="n">low</span> <span class="o">=</span> <span class="n">factors</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="c1"># take the second half and invert the order</span>
            <span class="n">high</span> <span class="o">=</span> <span class="n">factors</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># Sum both arrays and sort them before reenter</span>
            <span class="n">factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">low</span> <span class="o">*</span> <span class="n">high</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">factors</span><span class="p">]</span></div>


<div class="viewcode-block" id="rotation_matrix_around_axis_angle"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.rotation_matrix_around_axis_angle">[docs]</a><span class="k">def</span> <span class="nf">rotation_matrix_around_axis_angle</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the rotation matrix needed to rotate any vector</span>
<span class="sd">    around the &#39;axis&#39; an angle of &#39;theta&#39; radians</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Given a unit vector u = (ux, uy, uz), where ux**2 + uy**2 + uz**2 = 1,</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">unit_vector</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="c1"># with ux is the cross product matrix</span>
    <span class="n">ux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="o">-</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
    <span class="c1"># uxu is the tensor product of u</span>
    <span class="n">uxu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># This is a matrix form of Rodrigues &#39;rotation formula&#39;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">*</span> <span class="n">uxu</span></div>


<div class="viewcode-block" id="rotate_towards_axis"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.rotate_towards_axis">[docs]</a><span class="k">def</span> <span class="nf">rotate_towards_axis</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># If the vector is already parallel to the axis, do nothing</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">angle_vector</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">axis</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1E-10</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">angle_vector</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1E-10</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">vector</span>

    <span class="c1"># Create a unitary vector perpendicular to the plane created by vector and axis</span>
    <span class="n">uv</span> <span class="o">=</span> <span class="n">unit_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">axis</span><span class="p">))</span>

    <span class="c1"># Use the rodrigues formula to rotate around the vector perpendicular</span>
    <span class="k">if</span> <span class="n">theta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">rotation_matrix_around_axis_angle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fraction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">angle_vector</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">rotation_matrix_around_axis_angle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span></div>


<div class="viewcode-block" id="rotation_x"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.rotation_x">[docs]</a><span class="k">def</span> <span class="nf">rotation_x</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a rotation matrix around the &#39;x&#39; axis</span>

<span class="sd">    :param theta: (float) Angle in radians</span>
<span class="sd">    :return: (numpy.ndarray)</span>

<span class="sd">    Examples:</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>

<span class="sd">    &gt;&gt;&gt; m = rotation_x(np.pi/3)</span>

<span class="sd">    &gt;&gt;&gt; np.max(np.dot(m.T, m) - np.eye(3)) &lt; 1E-10</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)]])</span></div>


<div class="viewcode-block" id="rotation_y"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.rotation_y">[docs]</a><span class="k">def</span> <span class="nf">rotation_y</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a rotation matrix around the &#39;y&#39; axis</span>

<span class="sd">    :param theta: (float) Angle in radians</span>
<span class="sd">    :return: (numpy.ndarray)</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>

<span class="sd">    &gt;&gt;&gt; m = rotation_y(np.pi/3)</span>

<span class="sd">    &gt;&gt;&gt; np.max(np.dot(m.T, m) - np.eye(3)) &lt; 1E-10</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)]])</span></div>


<div class="viewcode-block" id="rotation_z"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.rotation_z">[docs]</a><span class="k">def</span> <span class="nf">rotation_z</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a rotation matrix around the &#39;z&#39; axis</span>

<span class="sd">    :param theta: (float) Angle in radians</span>
<span class="sd">    :return: (numpy.ndarray)</span>

<span class="sd">    Examples:</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; m = rotation_z(np.pi/3)</span>

<span class="sd">    &gt;&gt;&gt; np.max(np.dot(m.T, m) - np.eye(3)) &lt; 1E-10</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span></div>


<div class="viewcode-block" id="apply_rotation"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.apply_rotation">[docs]</a><span class="k">def</span> <span class="nf">apply_rotation</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">theta_x</span><span class="p">,</span> <span class="n">theta_y</span><span class="p">,</span> <span class="n">theta_z</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply a rotation matrix to a vector by succesive rotations around</span>
<span class="sd">    the three axis &#39;x&#39;, &#39;y&#39; and &#39;z&#39;</span>

<span class="sd">    :param vector:</span>
<span class="sd">    :param theta_x: (float) Angle in radians</span>
<span class="sd">    :param theta_y: (float) Angle in radians</span>
<span class="sd">    :param theta_z: (float) Angle in radians</span>
<span class="sd">    :return: (numpy.ndarray)</span>

<span class="sd">  Example:</span>
<span class="sd">    &gt;&gt;&gt; a = apply_rotation([0.1, 0.2, 0.3], 3.1415/3, 3.1415/4, 3.1415/5)</span>
<span class="sd">    &gt;&gt;&gt; b = apply_rotation(a, -3.1415/3, 0, 0)</span>
<span class="sd">    &gt;&gt;&gt; c = apply_rotation(b, 0, -3.1415/4, 0)</span>
<span class="sd">    &gt;&gt;&gt; d = apply_rotation(c, 0, 0, -3.1415/5)</span>

<span class="sd">    &gt;&gt;&gt; d</span>
<span class="sd">    array([0.1, 0.2, 0.3])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotation_x</span><span class="p">(</span><span class="n">theta_x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotation_y</span><span class="p">(</span><span class="n">theta_y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotation_z</span><span class="p">(</span><span class="n">theta_z</span><span class="p">),</span> <span class="n">vector</span><span class="p">))),</span> <span class="mi">14</span><span class="p">)</span></div>


<div class="viewcode-block" id="rotation_matrix_weave"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.rotation_matrix_weave">[docs]</a><span class="k">def</span> <span class="nf">rotation_matrix_weave</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">mat</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">weave</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    <span class="k">if</span> <span class="n">mat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">support</span> <span class="o">=</span> <span class="s2">&quot;#include &lt;math.h&gt;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        double x = sqrt(axis[0] * axis[0] + axis[1] * axis[1] + axis[2] * axis[2]);</span>
<span class="s2">        double a = cos(theta / 2.0);</span>
<span class="s2">        double b = -(axis[0] / x) * sin(theta / 2.0);</span>
<span class="s2">        double c = -(axis[1] / x) * sin(theta / 2.0);</span>
<span class="s2">        double d = -(axis[2] / x) * sin(theta / 2.0);</span>

<span class="s2">        mat[0] = a*a + b*b - c*c - d*d;</span>
<span class="s2">        mat[1] = 2 * (b*c - a*d);</span>
<span class="s2">        mat[2] = 2 * (b*d + a*c);</span>

<span class="s2">        mat[3*1 + 0] = 2*(b*c+a*d);</span>
<span class="s2">        mat[3*1 + 1] = a*a+c*c-b*b-d*d;</span>
<span class="s2">        mat[3*1 + 2] = 2*(c*d-a*b);</span>

<span class="s2">        mat[3*2 + 0] = 2*(b*d-a*c);</span>
<span class="s2">        mat[3*2 + 1] = 2*(c*d+a*b);</span>
<span class="s2">        mat[3*2 + 2] = a*a+d*d-b*b-c*c;</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">weave</span><span class="o">.</span><span class="n">inline</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;axis&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;mat&#39;</span><span class="p">],</span> <span class="n">support_code</span><span class="o">=</span><span class="n">support</span><span class="p">,</span> <span class="n">libraries</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">mat</span></div>


<div class="viewcode-block" id="rotation_matrix_numpy"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.rotation_matrix_numpy">[docs]</a><span class="k">def</span> <span class="nf">rotation_matrix_numpy</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param axis:</span>
<span class="sd">    :param theta:</span>
<span class="sd">    :return:</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; rotation_matrix_numpy([1, 1, 1], 3.1415926/4.0)</span>
<span class="sd">    array([[ 0.80473786,  0.50587935, -0.31061722],</span>
<span class="sd">           [-0.31061722,  0.80473786,  0.50587935],</span>
<span class="sd">           [ 0.50587935, -0.31061722,  0.80473786]])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">uaxis</span> <span class="o">=</span> <span class="n">unit_vector</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="o">-</span><span class="n">uaxis</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">c</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">c</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">d</span><span class="p">),</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">d</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span><span class="p">)],</span>
                     <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">d</span><span class="p">),</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">c</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)],</span>
                     <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span><span class="p">),</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">d</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">),</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">c</span><span class="p">]])</span></div>


<div class="viewcode-block" id="projector"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.projector">[docs]</a><span class="k">def</span> <span class="nf">projector</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the projector of &#39;v&#39; over &#39;u&#39;</span>
<span class="sd">    A vector in the direction of &#39;u&#39; with a</span>
<span class="sd">    magnitude of the projection of &#39;v&#39; over &#39;u&#39;</span>

<span class="sd">    :param u:</span>
<span class="sd">    :param v:</span>
<span class="sd">    :return:</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; projector([0.1, 0.2, 0.3], [0.3, 0.2, 0.1])</span>
<span class="sd">    array([0.07142857, 0.14285714, 0.21428571])</span>
<span class="sd">    &gt;&gt;&gt; projector([1, 0, 0], [0, 2, 0])</span>
<span class="sd">    array([0., 0., 0.])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">u</span><span class="p">)</span></div>


<div class="viewcode-block" id="gram_smith"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.gram_smith">[docs]</a><span class="k">def</span> <span class="nf">gram_smith</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a Gram-Smith ortoganalized</span>
<span class="sd">    matrix, using the first vector of</span>
<span class="sd">    matrix &#39;m&#39; to build the ortogonal</span>
<span class="sd">    set of vectors</span>

<span class="sd">    :param m:</span>
<span class="sd">    :return:</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; o = gram_smith(np.random.rand(3, 3))</span>

<span class="sd">    &gt;&gt;&gt; np.round(np.abs(np.linalg.det(o)), 10) == 1.0</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
    <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">ret</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="n">ret</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">projector</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">ret</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="gram_smith_qr"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.gram_smith_qr">[docs]</a><span class="k">def</span> <span class="nf">gram_smith_qr</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a Gram-Smith orthoganalized matrix.</span>
<span class="sd">    The argument is the dimension of the matrix</span>
<span class="sd">    and uses a random matrix and QR decomposition</span>
<span class="sd">    to build the orthogonal matrix</span>

<span class="sd">    :param ndim: Dimension of the matrix</span>
<span class="sd">    :return:</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; o = gram_smith_qr(3)</span>
<span class="sd">    &gt;&gt;&gt; np.round(np.abs(np.linalg.det(o)), 10)==1.0</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matrix_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">matrix_a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1E-5</span><span class="p">:</span>
        <span class="n">matrix_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">qr</span><span class="p">(</span><span class="n">matrix_a</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">eye</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span>
        <span class="n">eye</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">eye</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="cartesian_to_spherical"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.cartesian_to_spherical">[docs]</a><span class="k">def</span> <span class="nf">cartesian_to_spherical</span><span class="p">(</span><span class="n">xyz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a numpy array (Nx3) into</span>
<span class="sd">    a numpy array (Nx3) where the first</span>
<span class="sd">    column is the magnitude of the vector</span>
<span class="sd">    and second and third are spherical angles</span>

<span class="sd">    We use the mathematical notation</span>
<span class="sd">    (radial, azimuthal, polar)</span>

<span class="sd">    :param xyz: numpy.array</span>
<span class="sd">    :return: numpy.array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">spherical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">spherical</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xy</span> <span class="o">+</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">spherical</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">spherical</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xy</span><span class="p">),</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>  <span class="c1"># for elevation angle defined from Z-axis down</span>
    <span class="c1"># spherical[:, 2] = np.arctan2(xyz[:, 2], np.sqrt(xy))   # for elevation angle defined from XY-plane up</span>
    <span class="k">return</span> <span class="n">spherical</span></div>


<div class="viewcode-block" id="spherical_to_cartesian"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.spherical_to_cartesian">[docs]</a><span class="k">def</span> <span class="nf">spherical_to_cartesian</span><span class="p">(</span><span class="n">spherical</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a numpy array (Nx3) from</span>
<span class="sd">    spherical coordinates to cartesian</span>
<span class="sd">    coordinates</span>

<span class="sd">    We use the mathematical notation</span>
<span class="sd">    (radial, azimuthal, polar)</span>

<span class="sd">    :param spherical: numpy.array</span>
<span class="sd">    :return: numpy.array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spherical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spherical</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">spherical</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spherical</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">spherical</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">spherical</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">spherical</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">spherical</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">spherical</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">spherical</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">spherical</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">xyz</span></div>


<div class="viewcode-block" id="rotation_ndim"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.rotation_ndim">[docs]</a><span class="k">def</span> <span class="nf">rotation_ndim</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a rotation matrix for the Euclidean space in ndim dimensions.</span>
<span class="sd">    The angle &#39;theta&#39; is in radians and the indices should be a list of two</span>
<span class="sd">    values where defining the plane of rotation</span>

<span class="sd">    :param ndim: Dimension of the matrix</span>
<span class="sd">    :param theta: Angle of rotation in radians</span>
<span class="sd">    :param indices: Indices of the plane where the rotation takes place.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1E-20</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="c1"># print(&#39;Rotation of angle %f on plane %s\n %s&#39; % (theta, indices, rot))</span>
    <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="iterative_rotation_angles"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.iterative_rotation_angles">[docs]</a><span class="k">def</span> <span class="nf">iterative_rotation_angles</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">nrounds</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Make a copy of the original matrix</span>
    <span class="n">ident</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="c1"># The dimension of the matrix</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># The angles is an ordered list of operations</span>
    <span class="c1"># Rotations form a non-abelian group</span>
    <span class="n">rotation_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">inverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrounds</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
            <span class="c1"># Compute the angle to align the plane i</span>
            <span class="c1"># into the canonical base</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">ident</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># Numerator</span>
            <span class="n">den</span> <span class="o">=</span> <span class="n">ident</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>  <span class="c1"># Denominator</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Numerator: </span><span class="si">%f</span><span class="s1"> Denominator: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1E-18</span><span class="p">:</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">den</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1E-18</span><span class="p">:</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="o">-</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">den</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">theta</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span>
            <span class="n">rotation_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">theta</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
            <span class="c1"># Compute a rotation matrix for plane i</span>
            <span class="n">rot</span> <span class="o">=</span> <span class="n">rotation_ndim</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="c1"># Apply the rotation left side</span>
            <span class="c1"># print(&#39;Before rotation  for %s with angle %f \n %s&#39; % (tuple(i), theta, mp))</span>
            <span class="n">ident</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="n">rot</span><span class="p">))</span>
            <span class="n">inverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inverse</span><span class="p">,</span> <span class="n">rot</span><span class="p">)</span>
            <span class="c1"># print(&#39;After rotation for %s with angle %f \n %s&#39; % (tuple(i), theta, mp))</span>

    <span class="c1"># rotation_list is a list of Generalized Euler Angles</span>
    <span class="c1"># ident is a matrix that should be close to Identity</span>
    <span class="c1"># inverse is the return matrix, the matrix that should be</span>
    <span class="c1"># close to the inverse (tranpose) of the original matrix</span>
    <span class="k">return</span> <span class="n">rotation_list</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">inverse</span></div>


<div class="viewcode-block" id="rotation_matrix_ndim"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.rotation_matrix_ndim">[docs]</a><span class="k">def</span> <span class="nf">rotation_matrix_ndim</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span> <span class="n">rotation_list</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rotation</span> <span class="ow">in</span> <span class="n">rotation_list</span><span class="p">:</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">rotation_ndim</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span> <span class="n">rotation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rotation</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">rot</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="gea_angles"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.gea_angles">[docs]</a><span class="k">def</span> <span class="nf">gea_angles</span><span class="p">(</span><span class="n">uvector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generalized Euler Angles</span>
<span class="sd">    Return the parametric angles decribed on Eq. 1 from the paper</span>

<span class="sd">    Generalization of Euler Angles to N-Dimensional Orthogonal Matrices</span>
<span class="sd">    David K. Hoffman, Richard C. Raffenetti, and Klaus Ruedenberg</span>
<span class="sd">    Journal of Mathematical Physics 13, 528 (1972)</span>
<span class="sd">    doi: 10.1063/1.1666011</span>

<span class="sd">    :param uvector: A n-dimensional vector</span>
<span class="sd">    :return: n dimensional list of angles, the last one is pi/2</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">uvector</span><span class="p">)</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">uvector</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">uvector</span><span class="p">)</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">uvector</span><span class="p">)</span>
    <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uvector</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Vector need to be at least dim=2&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">:</span>
            <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># print(&#39;Sin: %f Angle: %f&#39;% (tmp[0], theta))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">theta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">theta</span>
            <span class="k">elif</span> <span class="n">theta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">theta</span>
        <span class="c1"># print(&#39;Sin: %f Angle: %f %s&#39;% (tmp[0], theta, tmp))</span>
        <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1E-8</span><span class="p">:</span>
            <span class="k">pass</span>
            <span class="c1"># print(&#39;ALERT: Zero denominator with numerator: %s&#39; % tmp[1:])</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1E-8</span><span class="p">:</span>
            <span class="k">pass</span>
            <span class="c1"># print(&#39;ALERT: Zero denominator with numerator: %s %f&#39; % (tmp, max(tmp)))</span>
    <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">angles</span></div>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Generalization of Euler Angles to N-Dimensional Orthogonal Matrices</span>
<span class="sd">David K. Hoffman, Richard C. Raffenetti, and Klaus Ruedenberg</span>
<span class="sd">Journal of Mathematical Physics 13, 528 (1972)</span>
<span class="sd">doi: 10.1063/1.1666011</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="gea_matrix_a"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.gea_matrix_a">[docs]</a><span class="k">def</span> <span class="nf">gea_matrix_a</span><span class="p">(</span><span class="n">angles</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generalized Euler Angles</span>
<span class="sd">    Return the parametric angles described on Eqs. 15-19 from the paper:</span>

<span class="sd">    Generalization of Euler Angles to N-Dimensional Orthogonal Matrices</span>
<span class="sd">    David K. Hoffman, Richard C. Raffenetti, and Klaus Ruedenberg</span>
<span class="sd">    Journal of Mathematical Physics 13, 528 (1972)</span>
<span class="sd">    doi: 10.1063/1.1666011</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
    <span class="n">matrix_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">matrix_a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">matrix_a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">matrix_a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
                <span class="n">matrix_a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">matrix_a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>

    <span class="n">matrix_a</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">matrix_a</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">matrix_a</span></div>


<div class="viewcode-block" id="gea_all_angles"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.gea_all_angles">[docs]</a><span class="k">def</span> <span class="nf">gea_all_angles</span><span class="p">(</span><span class="n">ortho_matrix</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generalized Euler Angles</span>
<span class="sd">    Return the generalized angles described from the paper</span>

<span class="sd">    Generalization of Euler Angles to N-Dimensional Orthogonal Matrices</span>
<span class="sd">    David K. Hoffman, Richard C. Raffenetti, and Klaus Ruedenberg</span>
<span class="sd">    Journal of Mathematical Physics 13, 528 (1972)</span>
<span class="sd">    doi: 10.1063/1.1666011</span>

<span class="sd">    :param ortho_matrix: Orthogonal Matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ortho_matrix</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># print(&#39;Original matrix\n%s&#39; % b)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="c1"># Lets take vectors starting from the last column on ortho_matrix</span>
        <span class="n">an</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># print(&#39;Vector: \n%s&#39; % an)</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="n">gea_angles</span><span class="p">(</span><span class="n">an</span><span class="p">)</span>
        <span class="c1"># print(&#39;Angles: \n%s&#39; % angles)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">gea_matrix_a</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
        <span class="c1"># print(&#39;Matrix a: \n%s&#39; % a)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="c1"># print(&#39;New matrix b: \n%s&#39; % b)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># print(&#39;New matrix b (fixed): \n%s&#39; % b)</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="n">angles</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="gea_orthogonal_from_angles"><a class="viewcode-back" href="../../../pychemia.utils.html#pychemia.utils.mathematics.gea_orthogonal_from_angles">[docs]</a><span class="k">def</span> <span class="nf">gea_orthogonal_from_angles</span><span class="p">(</span><span class="n">angles_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generalized Euler Angles</span>
<span class="sd">    Return the orthogonal matrix from its generalized angles</span>

<span class="sd">    Generalization of Euler Angles to N-Dimensional Orthogonal Matrices</span>
<span class="sd">    David K. Hoffman, Richard C. Raffenetti, and Klaus Ruedenberg</span>
<span class="sd">    Journal of Mathematical Physics 13, 528 (1972)</span>
<span class="sd">    doi: 10.1063/1.1666011</span>

<span class="sd">    :param angles_list: List of angles, for a n-dimensional space the total number</span>
<span class="sd">                        of angles is k*(k-1)/2</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">angles_list</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">angles_list</span><span class="p">)</span>

    <span class="c1"># For SO(k) there are k*(k-1)/2 angles that are grouped in k-1 sets</span>
    <span class="c1"># { (k-1 angles), (k-2 angles), ... , (1 angle)}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tmp</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">:],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[:</span><span class="o">-</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ma</span> <span class="o">=</span> <span class="n">gea_matrix_a</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>  <span class="c1"># matrix i+1 x i+1</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">ma</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># We skip doing making a larger matrix for the last iteration</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">c</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">c</span>
    <span class="k">return</span> <span class="n">b</span></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Guillermo Avendano-Franco.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.1.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>